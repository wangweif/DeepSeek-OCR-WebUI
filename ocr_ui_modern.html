<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ä½œä¸šè¯†åˆ«</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
            --text: #374151;
            --text-light: #6b7280;
            --shadow: rgba(0, 0, 0, 0.1);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Find Mode Container - å·¦å³åˆ†æ å¸ƒå±€ */
        .find-mode-container {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px var(--shadow);
            animation: fadeIn 0.5s ease-out;
        }

        .find-mode-container.active {
            display: block;
        }

        .find-split-layout {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 30px;
            min-height: 600px;
        }

        /* å·¦ä¾§é¢æ¿ - ä¸Šä¼ å’Œæ§åˆ¶ */
        .find-left-panel {
            border-right: 2px solid var(--border);
            padding-right: 30px;
        }

        .find-panel-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .find-upload-zone {
            border: 3px dashed var(--border);
            border-radius: var(--radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--light);
            margin-bottom: 25px;
        }

        .find-upload-zone:hover {
            border-color: var(--primary);
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .find-upload-zone.drag-over {
            border-color: var(--primary);
            background: #e0e7ff;
            transform: scale(1.02);
        }

        .find-upload-icon {
            font-size: 60px;
            margin-bottom: 15px;
            opacity: 0.6;
        }

        .find-upload-text {
            font-size: 1.1em;
            color: var(--text);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .find-upload-hint {
            font-size: 0.9em;
            color: var(--text-light);
        }

        .find-uploaded-preview {
            display: none;
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }

        .find-uploaded-preview.active {
            display: block;
        }

        .find-uploaded-preview img {
            width: 100%;
            display: block;
            max-height: 250px;
            object-fit: contain;
            background: #000;
        }

        .find-uploaded-info {
            padding: 12px;
            background: var(--light);
            font-size: 0.9em;
            color: var(--text-light);
        }

        .find-input-group {
            margin-bottom: 25px;
        }

        .find-input-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95em;
        }

        .find-input-field {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .find-input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .find-input-hint {
            margin-top: 8px;
            font-size: 0.85em;
            color: var(--text-light);
            line-height: 1.4;
        }

        .find-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .find-btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: var(--radius);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .find-btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .find-btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .find-btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .find-btn-secondary {
            background: white;
            color: var(--text);
            border: 2px solid var(--border);
        }

        .find-btn-secondary:hover {
            background: var(--light);
            border-color: var(--primary);
        }

        /* å³ä¾§é¢æ¿ - ç»“æœå±•ç¤º */
        .find-right-panel {
            padding-left: 30px;
        }
        
        .find-right-panel .find-result-image-wrapper {
            text-align: center;
        }

        .find-result-container {
            display: none;
        }

        .find-result-container.active {
            display: block;
        }

        .find-result-empty {
            text-align: center;
            padding: 80px 40px;
            color: var(--text-light);
        }

        .find-result-empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .find-result-empty-text {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .find-result-empty-hint {
            font-size: 0.95em;
        }

        .find-result-image-wrapper {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            background: #000;
            display: inline-block;
            max-width: 100%;
        }

        .find-result-image-wrapper img {
            display: block;
            width: auto;
            height: auto;
            max-width: 100%;
            max-height: 600px;
        }

        .find-result-image-wrapper canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .find-result-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .find-stat-badge {
            padding: 8px 16px;
            background: var(--light);
            border-radius: 20px;
            font-size: 0.9em;
            color: var(--text);
            font-weight: 500;
        }

        .find-stat-badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .find-result-text-area {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .find-result-text {
            font-size: 1em;
            line-height: 1.6;
            color: var(--text);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .find-matches-list {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
        }

        .find-matches-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .find-match-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }

        .find-match-color {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .find-match-info {
            flex: 1;
        }

        .find-match-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 3px;
        }

        .find-match-coords {
            font-size: 0.85em;
            color: var(--text-light);
            font-family: 'Courier New', monospace;
        }

        /* æ‰¹é‡å¤„ç†ä¸»å®¹å™¨ - é»˜è®¤æ˜¾ç¤º */
        .batch-mode-container {
            display: block;
        }

        .batch-mode-container.hidden {
            display: none;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s ease-out;
        }

        .header h1 {
            color: white;
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2em;
        }

        /* Main Card */
        .main-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out;
        }

        /* Mode Selector */
        .mode-section {
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .mode-title {
            color: white;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        .mode-option {
            background: rgba(255,255,255,0.15);
            border: 2px solid transparent;
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .mode-option:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }

        .mode-option.active {
            background: white;
            border-color: white;
            color: var(--primary);
        }

        .mode-icon {
            font-size: 2em;
            display: block;
            margin-bottom: 8px;
        }

        .mode-name {
            font-weight: 600;
            color: white;
        }

        .mode-option.active .mode-name {
            color: var(--primary);
        }

        /* Upload Section */
        .upload-section {
            padding: 40px;
            border-bottom: 1px solid var(--border);
        }

        .upload-area {
            border: 3px dashed var(--border);
            border-radius: var(--radius);
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--light);
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: var(--primary);
            background: #eef2ff;
        }

        .upload-icon {
            font-size: 4em;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2em;
            color: var(--text);
            margin-bottom: 10px;
        }

        .upload-hint {
            color: var(--text-light);
        }

        input[type="file"] {
            display: none;
        }

        /* Images Grid */
        .images-section {
            padding: 40px;
            display: none;
        }

        .images-section.active {
            display: block;
        }

        /* Single Image Section (Find æ¨¡å¼) */
        .single-image-section {
            padding: 40px;
            display: none;
        }

        .single-image-section.active {
            display: block;
        }

        .single-image-preview {
            background: var(--bg-light);
            border: 3px dashed var(--border-color);
            border-radius: 20px;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-center;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .single-image-preview:hover {
            border-color: var(--primary-color);
            background: var(--bg-lighter);
        }

        .single-image-preview.drag-over {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            transform: scale(1.02);
        }

        .preview-placeholder {
            text-align: center;
            padding: 60px 40px;
        }

        .preview-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .preview-text {
            font-size: 1.3em;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .preview-hint {
            color: var(--text-light);
            font-size: 0.95em;
        }

        .preview-container {
            width: 100%;
            padding: 20px;
        }

        .preview-image-wrapper {
            position: relative;
            display: inline-block;
            max-width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }

        .preview-image-wrapper img {
            display: block;
            max-width: 100%;
            height: auto;
        }

        .preview-image-wrapper canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--dark);
        }

        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .image-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            cursor: move;
            transition: all 0.3s;
            position: relative;
        }

        .image-card:hover {
            box-shadow: 0 8px 24px var(--shadow);
            transform: translateY(-4px);
        }

        .image-card.dragging {
            opacity: 0.5;
        }

        .image-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--light);
        }

        .image-info {
            padding: 12px;
        }

        .image-name {
            font-weight: 600;
            font-size: 0.9em;
            color: var(--dark);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .image-size {
            font-size: 0.85em;
            color: var(--text-light);
        }

        .image-order {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .image-remove {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .image-remove:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .image-status {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px;
            text-align: center;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-processing {
            background: rgba(245, 158, 11, 0.9);
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.9);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.9);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: var(--radius);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Progress Section */
        .progress-section {
            padding: 30px 40px;
            background: var(--light);
            display: none;
        }

        .progress-section.active {
            display: block;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-title {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--dark);
        }

        .progress-stats {
            display: flex;
            gap: 20px;
        }

        .progress-stat {
            font-size: 0.95em;
            color: var(--text-light);
        }

        .progress-stat strong {
            color: var(--primary);
            font-weight: 700;
        }

        .progress-bar-container {
            background: white;
            border-radius: 8px;
            height: 12px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s;
            border-radius: 8px;
        }

        /* Result Section */
        .result-section {
            padding: 40px;
            display: none;
        }

        .result-section.active {
            display: block;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .result-actions {
            display: flex;
            gap: 10px;
        }

        .result-text {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 600px;
            overflow-y: auto;
            color: var(--dark);
        }

        /* Image Result Styles */
        .image-result-section {
            margin-bottom: 25px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            background: white;
        }

        .image-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-bottom: 1px solid var(--border);
        }

        .image-result-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1em;
        }

        .image-result-container {
            padding: 20px;
            text-align: center;
            background: #fafbfc;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
            border-radius: 6px;
        }

        .result-empty {
            text-align: center;
            padding: 60px;
            color: var(--text-light);
        }

        .result-empty-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 16px 24px;
            border-radius: var(--radius);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideIn 0.3s;
        }

        .toast.active {
            display: flex;
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.info { border-left: 4px solid var(--primary); }

        .toast-icon {
            font-size: 1.5em;
        }

        .toast-message {
            font-weight: 500;
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 1s linear infinite;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .header p {
                font-size: 1em;
            }

            .mode-grid {
                grid-template-columns: 1fr;
            }

            .upload-section,
            .images-section,
            .result-section {
                padding: 20px;
            }

            .upload-area {
                padding: 40px 20px;
            }

            .images-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 12px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .section-header,
            .result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .result-actions {
                width: 100%;
            }

            .toast {
                bottom: 20px;
                right: 20px;
                left: 20px;
            }
        }

        /* Log Section */
        .log-section {
            padding: 40px;
            background: var(--light);
            border-top: 1px solid var(--border);
            display: none;
        }

        .log-section.active {
            display: block;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .log-title {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--dark);
        }

        .log-stats {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
            color: var(--text-light);
        }

        .log-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .log-container {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            max-height: 400px;
            overflow-y: auto;
            padding: 16px;
        }

        .log-item {
            padding: 12px 16px;
            margin-bottom: 10px;
            background: var(--light);
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            animation: slideInLog 0.3s;
            transition: all 0.3s;
        }

        .log-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .log-item.success {
            border-left-color: var(--success);
        }

        .log-item.error {
            border-left-color: var(--danger);
        }

        .log-item.warning {
            border-left-color: var(--warning);
        }

        .log-item.info {
            border-left-color: var(--primary);
        }

        .log-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .log-time {
            color: var(--text-light);
            font-size: 0.85em;
            font-family: monospace;
        }

        .log-type {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .log-type.success { background: #d1fae5; color: #065f46; }
        .log-type.error { background: #fee2e2; color: #991b1b; }
        .log-type.warning { background: #fef3c7; color: #92400e; }
        .log-type.info { background: #dbeafe; color: #1e40af; }

        .log-message {
            color: var(--dark);
            line-height: 1.6;
            font-size: 0.95em;
        }

        .log-detail {
            margin-top: 6px;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            font-size: 0.85em;
            color: var(--text-light);
            font-family: monospace;
        }

        @keyframes slideInLog {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #cbd5e1;
        }

        @media (max-width: 768px) {
            .log-panel {
                left: 10px;
                right: 10px;
                width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                

                

            </div>
            <p id="headerSubtitle" data-i18n="headerSubtitle">æ™ºèƒ½ä½œä¸šè¯†åˆ«</p>
        </div>


        <!-- Find Mode Container (å·¦å³åˆ†æ å¸ƒå±€) -->
        <div class="find-mode-container" id="findModeContainer">
            <div class="find-split-layout">
                <!-- å·¦ä¾§é¢æ¿ -->
                <div class="find-left-panel">
                    <div class="find-panel-title">
                        <span>ğŸ”</span>
                        <span>æŸ¥æ‰¾å®šä½</span>
                    </div>
                    
                    <!-- ä¸Šä¼ åŒºåŸŸ -->
                    <div class="find-upload-zone" id="findUploadZone">
                        <div class="find-upload-icon">ğŸ“¤</div>
                        <div class="find-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡æˆ– PDF</div>
                        <div class="find-upload-hint">æ”¯æŒ JPG, PNG, JPEG, BMP, GIF, PDFï¼ˆPDF å°†ä½¿ç”¨ç¬¬ä¸€é¡µï¼‰</div>
                    </div>
                    
                    <!-- å·²ä¸Šä¼ å›¾ç‰‡é¢„è§ˆ -->
                    <div class="find-uploaded-preview" id="findUploadedPreview">
                        <img id="findUploadedImage" alt="Uploaded" />
                        <div class="find-uploaded-info" id="findUploadedInfo"></div>
                    </div>
                    
                    <!-- æŸ¥æ‰¾è¯è¾“å…¥ -->
                    <div class="find-input-group">
                        <label class="find-input-label">
                            <span>ğŸ¯ è¾“å…¥æŸ¥æ‰¾å†…å®¹</span>
                        </label>
                        <input 
                            type="text" 
                            class="find-input-field" 
                            id="findTermInput"
                            placeholder="ä¾‹å¦‚ï¼šTotal, Invoice #, é‡‘é¢, å§“å"
                        />
                        <div class="find-input-hint">
                            ğŸ’¡ è¾“å…¥å›¾ç‰‡ä¸­éœ€è¦æŸ¥æ‰¾çš„æ–‡å­—ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å®šä½å¹¶æ ‡æ³¨
                        </div>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="find-actions">
                        <button class="find-btn find-btn-primary" id="findProcessBtn" disabled>
                            <span>ğŸš€</span>
                            <span>å¼€å§‹æŸ¥æ‰¾</span>
                        </button>
                        <button class="find-btn find-btn-secondary" id="findChangeBtn" disabled>
                            <span>ğŸ”„</span>
                            <span>æ›´æ¢å›¾ç‰‡</span>
                        </button>
                        <button class="find-btn find-btn-secondary" id="findClearBtn" disabled>
                            <span>ğŸ—‘ï¸</span>
                            <span>æ¸…ç©ºé‡ç½®</span>
                        </button>
                    </div>
                </div>
                
                <!-- å³ä¾§é¢æ¿ -->
                <div class="find-right-panel">
                    <div class="find-panel-title">
                        <span>âœ¨</span>
                        <span>è¯†åˆ«ç»“æœ</span>
                    </div>
                    
                    <!-- ç©ºçŠ¶æ€ -->
                    <div class="find-result-empty" id="findResultEmpty">
                        <div class="find-result-empty-icon">ğŸ¯</div>
                        <div class="find-result-empty-text">ç­‰å¾…è¯†åˆ«</div>
                        <div class="find-result-empty-hint">ä¸Šä¼ å›¾ç‰‡å¹¶è¾“å…¥æŸ¥æ‰¾è¯ï¼Œç‚¹å‡»"å¼€å§‹æŸ¥æ‰¾"å³å¯</div>
                    </div>
                    
                    <!-- ç»“æœå®¹å™¨ -->
                    <div class="find-result-container" id="findResultContainer">
                        <!-- ç»“æœå›¾ç‰‡ï¼ˆå¸¦è¾¹ç•Œæ¡†ï¼‰ -->
                        <div class="find-result-image-wrapper" id="findResultImageWrapper">
                            <img id="findResultImage" alt="Result" />
                            <canvas id="findResultCanvas"></canvas>
                        </div>
                        
                        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                        <div class="find-result-stats" id="findResultStats"></div>
                        
                        <!-- è¯†åˆ«æ–‡æœ¬ -->
                        <div class="find-result-text-area">
                            <div class="find-result-text" id="findResultText">ç­‰å¾…è¯†åˆ«...</div>
                        </div>
                        
                        <!-- åŒ¹é…é¡¹åˆ—è¡¨ -->
                        <div class="find-matches-list" id="findMatchesList" style="display: none;">
                            <div class="find-matches-title">
                                <span>ğŸ“¦</span>
                                <span>æ‰¾åˆ°çš„åŒ¹é…é¡¹</span>
                            </div>
                            <div id="findMatchesContent"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Batch Mode Container (æ‰¹é‡å¤„ç†æ¨¡å¼) -->
        <div class="batch-mode-container" id="batchModeContainer">
        <!-- Main Card -->
        <div class="main-card">
            <!-- Freeform Prompt Input (æ‰¹é‡æ¨¡å¼ä¸“ç”¨) -->
            <div id="freeformInputBatch" style="display: none; margin-bottom: 20px; padding: 20px; background: rgba(240,240,240,0.8); border-radius: 12px;">
                <label style="display: block; margin-bottom: 10px; color: #333; font-weight: 600;">âœ¨ è‡ªå®šä¹‰æç¤ºè¯</label>
                <textarea id="customPromptBatch" placeholder="è¾“å…¥è‡ªå®šä¹‰æç¤ºè¯ï¼ˆå¦‚ï¼šæå–æ‰€æœ‰æ—¥æœŸå’Œé‡‘é¢ï¼‰" 
                          style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid rgba(100,100,100,0.3); background: rgba(255,255,255,0.95); color: #333; font-size: 14px; min-height: 80px; resize: vertical;"></textarea>
                <div style="margin-top: 8px; color: rgba(80,80,80,0.9); font-size: 12px;">
                    âœ¨ æç¤ºï¼šæè¿°ä½ æƒ³è¦çš„è¯†åˆ«æ•ˆæœï¼ŒAI ä¼šæŒ‰ç…§ä½ çš„è¦æ±‚å¤„ç†æ¯å¼ å›¾ç‰‡
                </div>
            </div>

            <!-- Upload Section -->
            <div class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">â˜ï¸</div>
                    <div class="upload-text" data-i18n="batchMode.uploadText">æ‹–æ‹½å›¾ç‰‡æˆ– PDF åˆ°è¿™é‡Œæˆ–ç‚¹å‡»ä¸Šä¼ </div>
                    <div class="upload-hint" data-i18n="batchMode.uploadHint">æ”¯æŒå¤šå¼ å›¾ç‰‡æ‰¹é‡ä¸Šä¼ ï¼ŒPDF ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå›¾ç‰‡ï¼Œå¯è°ƒæ•´å¤„ç†é¡ºåº</div>
                    <input type="file" id="fileInput" multiple accept="image/*,.pdf,application/pdf">
                </div>
            </div>

            <!-- Single Image Mode (Find æ¨¡å¼ä¸“ç”¨) -->
            <div class="single-image-section" id="singleImageSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">ğŸ” æŸ¥æ‰¾å®šä½æ¨¡å¼ - å•å›¾å¤„ç†</div>
                    <div style="color: var(--text-light); font-size: 0.9em;">ğŸ’¡ ä¸Šä¼ å›¾ç‰‡åå°†è‡ªåŠ¨æ ‡æ³¨æ‰¾åˆ°çš„ä½ç½®</div>
                </div>
                <div class="single-image-preview" id="singleImagePreview">
                    <div class="preview-placeholder">
                        <div class="preview-icon">ğŸ–¼ï¸</div>
                        <div class="preview-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å•å¼ å›¾ç‰‡</div>
                        <div class="preview-hint">æ”¯æŒ JPG, PNG, JPEG, BMP, GIF</div>
                    </div>
                    <div class="preview-container" id="previewContainer" style="display: none;">
                        <div class="preview-image-wrapper">
                            <img id="previewImage" alt="Preview" style="display: block; max-width: 100%; height: auto;">
                            <canvas id="boundingBoxCanvas" style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
                        </div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" id="processSingleBtn">
                        <span>ğŸš€</span> å¼€å§‹æŸ¥æ‰¾
                    </button>
                    <button class="btn btn-secondary" id="changeSingleBtn">
                        <span>ğŸ”„</span> æ›´æ¢å›¾ç‰‡
                    </button>
                    <button class="btn btn-danger" id="clearSingleBtn">
                        <span>ğŸ—‘ï¸</span> æ¸…ç©º
                    </button>
                </div>
            </div>

            <!-- Images Grid Section (æ‰¹é‡æ¨¡å¼) -->
            <div class="images-section" id="imagesSection">
                <div class="section-header">
                    <div class="section-title">å·²ä¸Šä¼ å›¾ç‰‡ (<span id="imageCount">0</span>)</div>
                    <div style="color: var(--text-light); font-size: 0.9em;">ğŸ’¡ æ‹–åŠ¨å›¾ç‰‡å¯è°ƒæ•´é¡ºåº</div>
                </div>
                <div class="images-grid" id="imagesGrid"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" id="processBtn">
                        <span>ğŸš€</span> å¼€å§‹è¯†åˆ«
                    </button>
                    <button class="btn btn-secondary" id="addMoreBtn">
                        <span>â•</span> ç»§ç»­æ·»åŠ 
                    </button>
                    <button class="btn btn-danger" id="clearBtn">
                        <span>ğŸ—‘ï¸</span> æ¸…ç©ºå…¨éƒ¨
                    </button>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="progress-section" id="progressSection">
                <div class="progress-header">
                    <div class="progress-title">è¯†åˆ«è¿›åº¦</div>
                    <div class="progress-stats">
                        <span class="progress-stat">å·²å¤„ç†: <strong><span id="processedCount">0</span></strong></span>
                        <span class="progress-stat">æ€»è®¡: <strong><span id="totalCount">0</span></strong></span>
                    </div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Result Section -->
            <div class="result-section" id="resultSection">
                <div class="result-header">
                    <div class="section-title">è¯†åˆ«ç»“æœ</div>
                    <div class="result-actions">
                        <button class="btn btn-success" id="copyBtn">
                            <span>ğŸ“‹</span> å¤åˆ¶æ–‡æœ¬
                        </button>
                        <button class="btn btn-primary" id="downloadBtn">
                            <span>â¬‡ï¸</span> ä¸‹è½½æ–‡æœ¬
                        </button>
                    </div>
                </div>

                <!-- Image Result Area (å¸¦çº¢è‰²æ¡†çš„å›¾åƒ) -->
                <div class="image-result-section" id="imageResultSection" style="display: none;">
                    <div class="image-result-header">
                        <div class="image-result-title">
                            <span>ğŸ¨</span>
                            <span>Image Result (æ™ºèƒ½æ ‡æ³¨)</span>
                        </div>
                        <div class="image-result-toggle">
                            <button class="btn btn-small btn-secondary" id="toggleImageResult">
                                <span>ğŸ‘ï¸</span>
                                <span>åˆ‡æ¢æ˜¾ç¤º</span>
                            </button>
                        </div>
                    </div>
                    <div class="image-result-container">
                        <img id="imageResultDisplay" alt="Image Result" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
                    </div>
                </div>

                <div class="result-text" id="resultText"></div>
            </div>

            <!-- Log Section -->
            <div class="log-section" id="logSection">
                <div class="log-header">
                    <div class="log-title"><span data-i18n="batchMode.logTitle">ğŸ“‹ æ“ä½œæ—¥å¿—</span></div>
                    <div class="log-stats">
                        <div class="log-stat">
                            <span>ğŸ“Š</span>
                            <span><span data-i18n="batchMode.logCount">å…±</span> <strong id="logCount">0</strong> <span data-i18n="batchMode.logRecords">æ¡è®°å½•</span></span>
                        </div>
                    </div>
                </div>
                <div class="log-container" id="logContent"></div>
            </div>
        </div>
        </div> <!-- End of batch-mode-container -->
        
        
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-icon" id="toastIcon">âœ“</span>
        <span class="toast-message" id="toastMessage">æ“ä½œæˆåŠŸ</span>
    </div>

    <script>
        // ====================================
        // Internationalization (i18n)
        // ====================================
        const translations = {
            'zh-CN': {
                headerSubtitle: 'æ™ºèƒ½ä½œä¸šè¯†åˆ«',
                modeTitle: 'é€‰æ‹©è¯†åˆ«æ¨¡å¼ï¼ˆå¢å¼ºç‰ˆï¼šæ–°å¢ Find å’Œ Freeformï¼‰',
                modes: {
                    document: 'æ–‡æ¡£è½¬Markdown',
                    ocr: 'é€šç”¨OCR',
                    free: 'çº¯æ–‡æœ¬æå–',
                    figure: 'å›¾è¡¨è§£æ',
                    describe: 'å›¾åƒæè¿°',
                    find: 'æŸ¥æ‰¾å®šä½',
                    freeform: 'è‡ªå®šä¹‰æç¤º'
                },
                findMode: {
                    title: 'æŸ¥æ‰¾å®šä½',
                    uploadText: 'ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡',
                    uploadHint: 'æ”¯æŒ JPG, PNG, JPEG, BMP, GIF',
                    inputLabel: 'è¾“å…¥æŸ¥æ‰¾å†…å®¹',
                    inputPlaceholder: 'ä¾‹å¦‚ï¼šTotal, Invoice #, é‡‘é¢, å§“å',
                    inputHint: 'è¾“å…¥å›¾ç‰‡ä¸­éœ€è¦æŸ¥æ‰¾çš„æ–‡å­—ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å®šä½å¹¶æ ‡æ³¨',
                    btnProcess: 'å¼€å§‹æŸ¥æ‰¾',
                    btnChange: 'æ›´æ¢å›¾ç‰‡',
                    btnClear: 'æ¸…ç©ºé‡ç½®',
                    resultTitle: 'è¯†åˆ«ç»“æœ',
                    emptyText: 'ç­‰å¾…è¯†åˆ«',
                    emptyHint: 'ä¸Šä¼ å›¾ç‰‡å¹¶è¾“å…¥æŸ¥æ‰¾è¯ï¼Œç‚¹å‡»"å¼€å§‹æŸ¥æ‰¾"å³å¯',
                    matchesTitle: 'æ‰¾åˆ°çš„åŒ¹é…é¡¹'
                },
                batchMode: {
                    uploadText: 'æ‹–æ‹½å›¾ç‰‡æˆ– PDF åˆ°è¿™é‡Œæˆ–ç‚¹å‡»ä¸Šä¼ ',
                    uploadHint: 'æ”¯æŒå¤šå¼ å›¾ç‰‡æ‰¹é‡ä¸Šä¼ ï¼ŒPDF ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå›¾ç‰‡ï¼Œå¯è°ƒæ•´å¤„ç†é¡ºåº',
                    freeformLabel: 'è‡ªå®šä¹‰æç¤ºè¯',
                    freeformPlaceholder: 'è¾“å…¥è‡ªå®šä¹‰æç¤ºè¯ï¼ˆå¦‚ï¼šæå–æ‰€æœ‰æ—¥æœŸå’Œé‡‘é¢ï¼‰',
                    freeformHint: 'æè¿°ä½ æƒ³è¦çš„è¯†åˆ«æ•ˆæœï¼ŒAI ä¼šæŒ‰ç…§ä½ çš„è¦æ±‚å¤„ç†æ¯å¼ å›¾ç‰‡',
                    imagesTitle: 'å·²ä¸Šä¼ å›¾ç‰‡',
                    imagesDragHint: 'æ‹–åŠ¨å›¾ç‰‡å¯è°ƒæ•´é¡ºåº',
                    btnProcess: 'å¼€å§‹è¯†åˆ«',
                    btnAddMore: 'ç»§ç»­æ·»åŠ ',
                    btnClear: 'æ¸…ç©ºå…¨éƒ¨',
                    progressTitle: 'è¯†åˆ«è¿›åº¦',
                    processed: 'å·²å¤„ç†:',
                    total: 'æ€»è®¡:',
                    resultTitle: 'è¯†åˆ«ç»“æœ',
                    btnCopy: 'å¤åˆ¶æ–‡æœ¬',
                    btnDownload: 'ä¸‹è½½æ–‡æœ¬',
                    logTitle: 'æ“ä½œæ—¥å¿—',
                    logCount: 'å…±',
                    logRecords: 'æ¡è®°å½•'
                },
                logTypes: {
                    success: 'æˆåŠŸ',
                    error: 'é”™è¯¯',
                    warning: 'è­¦å‘Š',
                    info: 'ä¿¡æ¯'
                },
                github: {
                    starButton: 'â­ Star on GitHub',
                    bannerTitle: 'â­ å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Ÿç»™æˆ‘ä»¬ä¸€ä¸ª Starï¼â­',
                    bannerDesc: 'å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·åœ¨ GitHub ä¸Šç»™æˆ‘ä»¬ä¸€ä¸ª Star æ”¯æŒä¸€ä¸‹ï¼',
                    bannerButton: 'â­ åœ¨ GitHub ä¸Šç»™æˆ‘ä»¬ Star',
                    linkHome: 'ğŸ  é¡¹ç›®ä¸»é¡µ',
                    linkIssues: 'ğŸ› é—®é¢˜åé¦ˆ',
                    linkDocs: 'ğŸ“– ä½¿ç”¨æ–‡æ¡£',
                    linkChangelog: 'ğŸ“ æ›´æ–°æ—¥å¿—',
                    madeWith: 'Made with â¤ï¸ by',
                    poweredBy: 'Powered by DeepSeek-OCR'
                }
            },
            'zh-TW': {
                headerSubtitle: 'æ™ºèƒ½åœ–åƒè­˜åˆ¥ Â· æ‰¹é‡è™•ç† Â· å¤šæ¨¡å¼æ”¯æ´ Â· æ”¯æ´ Apple Silicon',
                modeTitle: 'é¸æ“‡è­˜åˆ¥æ¨¡å¼ï¼ˆå¢å¼·ç‰ˆï¼šæ–°å¢ Find å’Œ Freeformï¼‰',
                modes: {
                    document: 'æ–‡æª”è½‰Markdown',
                    ocr: 'é€šç”¨OCR',
                    free: 'ç´”æ–‡æœ¬æå–',
                    figure: 'åœ–è¡¨è§£æ',
                    describe: 'åœ–åƒæè¿°',
                    find: 'æŸ¥æ‰¾å®šä½',
                    freeform: 'è‡ªå®šç¾©æç¤º'
                },
                findMode: {
                    title: 'æŸ¥æ‰¾å®šä½',
                    uploadText: 'é»æ“Šæˆ–æ‹–æ‹½ä¸Šå‚³åœ–ç‰‡',
                    uploadHint: 'æ”¯æ´ JPG, PNG, JPEG, BMP, GIF',
                    inputLabel: 'è¼¸å…¥æŸ¥æ‰¾å…§å®¹',
                    inputPlaceholder: 'ä¾‹å¦‚ï¼šTotal, Invoice #, é‡‘é¡, å§“å',
                    inputHint: 'è¼¸å…¥åœ–ç‰‡ä¸­éœ€è¦æŸ¥æ‰¾çš„æ–‡å­—ï¼Œç³»çµ±æœƒè‡ªå‹•å®šä½ä¸¦æ¨™è¨»',
                    btnProcess: 'é–‹å§‹æŸ¥æ‰¾',
                    btnChange: 'æ›´æ›åœ–ç‰‡',
                    btnClear: 'æ¸…ç©ºé‡ç½®',
                    resultTitle: 'è­˜åˆ¥çµæœ',
                    emptyText: 'ç­‰å¾…è­˜åˆ¥',
                    emptyHint: 'ä¸Šå‚³åœ–ç‰‡ä¸¦è¼¸å…¥æŸ¥æ‰¾è©ï¼Œé»æ“Š"é–‹å§‹æŸ¥æ‰¾"å³å¯',
                    matchesTitle: 'æ‰¾åˆ°çš„åŒ¹é…é …'
                },
                batchMode: {
                    uploadText: 'æ‹–æ‹½åœ–ç‰‡æˆ– PDF åˆ°é€™è£¡æˆ–é»æ“Šä¸Šå‚³',
                    uploadHint: 'æ”¯æ´å¤šå¼µåœ–ç‰‡æ‰¹é‡ä¸Šå‚³ï¼ŒPDF æœƒè‡ªå‹•è½‰æ›ç‚ºåœ–ç‰‡ï¼Œå¯èª¿æ•´è™•ç†é †åº',
                    freeformLabel: 'è‡ªå®šç¾©æç¤ºè©',
                    freeformPlaceholder: 'è¼¸å…¥è‡ªå®šç¾©æç¤ºè©ï¼ˆå¦‚ï¼šæå–æ‰€æœ‰æ—¥æœŸå’Œé‡‘é¡ï¼‰',
                    freeformHint: 'æè¿°ä½ æƒ³è¦çš„è­˜åˆ¥æ•ˆæœï¼ŒAI æœƒæŒ‰ç…§ä½ çš„è¦æ±‚è™•ç†æ¯å¼µåœ–ç‰‡',
                    imagesTitle: 'å·²ä¸Šå‚³åœ–ç‰‡',
                    imagesDragHint: 'æ‹–å‹•åœ–ç‰‡å¯èª¿æ•´é †åº',
                    btnProcess: 'é–‹å§‹è­˜åˆ¥',
                    btnAddMore: 'ç¹¼çºŒæ·»åŠ ',
                    btnClear: 'æ¸…ç©ºå…¨éƒ¨',
                    progressTitle: 'è­˜åˆ¥é€²åº¦',
                    processed: 'å·²è™•ç†:',
                    total: 'ç¸½è¨ˆ:',
                    resultTitle: 'è­˜åˆ¥çµæœ',
                    btnCopy: 'è¤‡è£½æ–‡æœ¬',
                    btnDownload: 'ä¸‹è¼‰æ–‡æœ¬',
                    logTitle: 'æ“ä½œæ—¥èªŒ',
                    logCount: 'å…±',
                    logRecords: 'æ¢è¨˜éŒ„'
                },
                logTypes: {
                    success: 'æˆåŠŸ',
                    error: 'éŒ¯èª¤',
                    warning: 'è­¦å‘Š',
                    info: 'è³‡è¨Š'
                },
                github: {
                    starButton: 'â­ Star on GitHub',
                    bannerTitle: 'â­ å–œæ­¡é€™å€‹é …ç›®ï¼Ÿçµ¦æˆ‘å€‘ä¸€å€‹ Starï¼â­',
                    bannerDesc: 'å¦‚æœé€™å€‹é …ç›®å°ä½ æœ‰å¹«åŠ©ï¼Œè«‹åœ¨ GitHub ä¸Šçµ¦æˆ‘å€‘ä¸€å€‹ Star æ”¯æŒä¸€ä¸‹ï¼',
                    bannerButton: 'â­ åœ¨ GitHub ä¸Šçµ¦æˆ‘å€‘ Star',
                    linkHome: 'ğŸ  é …ç›®ä¸»é ',
                    linkIssues: 'ğŸ› å•é¡Œåé¥‹',
                    linkDocs: 'ğŸ“– ä½¿ç”¨æ–‡æª”',
                    linkChangelog: 'ğŸ“ æ›´æ–°æ—¥èªŒ',
                    madeWith: 'Made with â¤ï¸ by',
                    poweredBy: 'Powered by DeepSeek-OCR'
                }
            },
            'en-US': {
                headerSubtitle: 'Intelligent Image Recognition Â· Batch Processing Â· Multi-Mode Support Â· Apple Silicon Ready',
                modeTitle: 'Select Recognition Mode (Enhanced: New Find & Freeform)',
                modes: {
                    document: 'Doc to Markdown',
                    ocr: 'General OCR',
                    free: 'Plain Text',
                    figure: 'Chart Parser',
                    describe: 'Image Description',
                    find: 'Find & Locate',
                    freeform: 'Custom Prompt'
                },
                findMode: {
                    title: 'Find & Locate',
                    uploadText: 'Click or drag to upload image',
                    uploadHint: 'Support JPG, PNG, JPEG, BMP, GIF',
                    inputLabel: 'Enter search term',
                    inputPlaceholder: 'e.g.: Total, Invoice #, Amount, Name',
                    inputHint: 'Enter text to find in image, system will locate automatically',
                    btnProcess: 'Start Search',
                    btnChange: 'Change Image',
                    btnClear: 'Clear & Reset',
                    resultTitle: 'Recognition Result',
                    emptyText: 'Waiting',
                    emptyHint: 'Upload image and enter search term, then click "Start Search"',
                    matchesTitle: 'Found Matches'
                },
                batchMode: {
                    uploadText: 'Drag images or PDF here or click to upload',
                    uploadHint: 'Support batch upload, PDF auto-converts to images, reorder as needed',
                    freeformLabel: 'Custom Prompt',
                    freeformPlaceholder: 'Enter custom prompt (e.g.: Extract all dates and amounts)',
                    freeformHint: 'Describe what you want, AI will process each image accordingly',
                    imagesTitle: 'Uploaded Images',
                    imagesDragHint: 'Drag to reorder',
                    btnProcess: 'Start Recognition',
                    btnAddMore: 'Add More',
                    btnClear: 'Clear All',
                    progressTitle: 'Progress',
                    processed: 'Processed:',
                    total: 'Total:',
                    resultTitle: 'Result',
                    btnCopy: 'Copy Text',
                    btnDownload: 'Download',
                    logTitle: 'Operation Log',
                    logCount: 'Total',
                    logRecords: 'records'
                },
                logTypes: {
                    success: 'Success',
                    error: 'Error',
                    warning: 'Warning',
                    info: 'Info'
                },
                github: {
                    starButton: 'â­ Star on GitHub',
                    bannerTitle: 'â­ Like this project? Give us a Star! â­',
                    bannerDesc: 'If this project helps you, please give us a Star on GitHub!',
                    bannerButton: 'â­ Star us on GitHub',
                    linkHome: 'ğŸ  Home',
                    linkIssues: 'ğŸ› Issues',
                    linkDocs: 'ğŸ“– Documentation',
                    linkChangelog: 'ğŸ“ Changelog',
                    madeWith: 'Made with â¤ï¸ by',
                    poweredBy: 'Powered by DeepSeek-OCR'
                }
            },
            'ja-JP': {
                headerSubtitle: 'ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆç”»åƒèªè­˜ Â· ãƒãƒƒãƒå‡¦ç† Â· ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ‰ã‚µãƒãƒ¼ãƒˆ Â· Apple Siliconå¯¾å¿œ',
                modeTitle: 'èªè­˜ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠï¼ˆæ‹¡å¼µç‰ˆï¼šFind ã¨ Freeform ã‚’è¿½åŠ ï¼‰',
                modes: {
                    document: 'ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’Markdownã¸',
                    ocr: 'æ±ç”¨OCR',
                    free: 'ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º',
                    figure: 'ãƒãƒ£ãƒ¼ãƒˆè§£æ',
                    describe: 'ç”»åƒèª¬æ˜',
                    find: 'æ¤œç´¢ã¨ä½ç½®ç‰¹å®š',
                    freeform: 'ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
                },
                findMode: {
                    title: 'æ¤œç´¢ã¨ä½ç½®ç‰¹å®š',
                    uploadText: 'ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
                    uploadHint: 'JPG, PNG, JPEG, BMP, GIF ã‚’ã‚µãƒãƒ¼ãƒˆ',
                    inputLabel: 'æ¤œç´¢å†…å®¹ã‚’å…¥åŠ›',
                    inputPlaceholder: 'ä¾‹ï¼šTotal, Invoice #, é‡‘é¡, åå‰',
                    inputHint: 'ç”»åƒå†…ã§æ¤œç´¢ã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã‚·ã‚¹ãƒ†ãƒ ãŒè‡ªå‹•çš„ã«ä½ç½®ã‚’ç‰¹å®šã—ã¾ã™',
                    btnProcess: 'æ¤œç´¢é–‹å§‹',
                    btnChange: 'ç”»åƒã‚’å¤‰æ›´',
                    btnClear: 'ã‚¯ãƒªã‚¢ã—ã¦ãƒªã‚»ãƒƒãƒˆ',
                    resultTitle: 'èªè­˜çµæœ',
                    emptyText: 'èªè­˜å¾…ã¡',
                    emptyHint: 'ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦æ¤œç´¢èªã‚’å…¥åŠ›ã—ã€ã€Œæ¤œç´¢é–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„',
                    matchesTitle: 'è¦‹ã¤ã‹ã£ãŸä¸€è‡´é …ç›®'
                },
                batchMode: {
                    uploadText: 'ç”»åƒã¾ãŸã¯PDFã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
                    uploadHint: 'ãƒãƒƒãƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾å¿œã€PDFã¯è‡ªå‹•çš„ã«ç”»åƒã«å¤‰æ›ã€é †åºèª¿æ•´å¯èƒ½',
                    freeformLabel: 'ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ',
                    freeformPlaceholder: 'ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šã™ã¹ã¦ã®æ—¥ä»˜ã¨é‡‘é¡ã‚’æŠ½å‡ºï¼‰',
                    freeformHint: 'å¸Œæœ›ã™ã‚‹èªè­˜åŠ¹æœã‚’èª¬æ˜ã™ã‚‹ã¨ã€AIãŒè¦æ±‚ã«å¿œã˜ã¦å„ç”»åƒã‚’å‡¦ç†ã—ã¾ã™',
                    imagesTitle: 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ç”»åƒ',
                    imagesDragHint: 'ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦é †åºã‚’èª¿æ•´',
                    btnProcess: 'èªè­˜é–‹å§‹',
                    btnAddMore: 'ã•ã‚‰ã«è¿½åŠ ',
                    btnClear: 'ã™ã¹ã¦ã‚¯ãƒªã‚¢',
                    progressTitle: 'èªè­˜é€²æ—',
                    processed: 'å‡¦ç†æ¸ˆã¿:',
                    total: 'åˆè¨ˆ:',
                    resultTitle: 'èªè­˜çµæœ',
                    btnCopy: 'ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼',
                    btnDownload: 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
                    logTitle: 'æ“ä½œãƒ­ã‚°',
                    logCount: 'åˆè¨ˆ',
                    logRecords: 'ä»¶ã®è¨˜éŒ²'
                },
                logTypes: {
                    success: 'æˆåŠŸ',
                    error: 'ã‚¨ãƒ©ãƒ¼',
                    warning: 'è­¦å‘Š',
                    info: 'æƒ…å ±'
                },
                github: {
                    starButton: 'â­ Star on GitHub',
                    bannerTitle: 'â­ ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæ°—ã«å…¥ã‚Šã¾ã—ãŸã‹ï¼ŸStarã‚’ãã ã•ã„ï¼â­',
                    bannerDesc: 'ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒãŠå½¹ã«ç«‹ã¡ã¾ã—ãŸã‚‰ã€GitHubã§Starã‚’ã¤ã‘ã¦ã‚µãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ï¼',
                    bannerButton: 'â­ GitHubã§Starã‚’ã¤ã‘ã‚‹',
                    linkHome: 'ğŸ  ãƒ›ãƒ¼ãƒ ',
                    linkIssues: 'ğŸ› å•é¡Œå ±å‘Š',
                    linkDocs: 'ğŸ“– ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ',
                    linkChangelog: 'ğŸ“ æ›´æ–°å±¥æ­´',
                    madeWith: 'Made with â¤ï¸ by',
                    poweredBy: 'Powered by DeepSeek-OCR'
                }
            }
        };
        
        // Current language
        let currentLang = localStorage.getItem('ocr_language') || 'zh-CN';
        
        // Get translation
        function t(path) {
            const keys = path.split('.');
            let value = translations[currentLang];
            for (const key of keys) {
                value = value?.[key];
                if (value === undefined) return path;
            }
            return value;
        }
        
        // Update all UI text
        function updateUILanguage() {
            console.log('ğŸŒ åˆ‡æ¢è¯­è¨€åˆ°:', currentLang);
            
            // Update header subtitle
            const subtitle = document.getElementById('headerSubtitle');
            if (subtitle) subtitle.textContent = t('headerSubtitle');
            
            // Update mode title
            const modeTitle = document.querySelector('.mode-title');
            if (modeTitle) modeTitle.textContent = t('modeTitle');
            
            // Update mode names
            document.querySelectorAll('.mode-option').forEach(option => {
                const mode = option.dataset.mode;
                const nameEl = option.querySelector('.mode-name');
                if (nameEl && t(`modes.${mode}`)) {
                    nameEl.textContent = t(`modes.${mode}`);
                }
            });
            
            // Update Find mode texts
            const findTexts = {
                '.find-panel-title span:last-child': 'findMode.title',
                '.find-upload-text': 'findMode.uploadText',
                '.find-upload-hint': 'findMode.uploadHint',
                '.find-input-label': 'findMode.inputLabel',
                '.find-result-empty-text': 'findMode.emptyText',
                '.find-result-empty-hint': 'findMode.emptyHint',
                '.find-matches-title span:last-child': 'findMode.matchesTitle'
            };
            
            for (const [selector, key] of Object.entries(findTexts)) {
                const el = document.querySelector(selector);
                if (el) el.textContent = t(key);
            }
            
            // Update Find mode placeholders and hints
            const findInput = document.getElementById('findTermInput');
            if (findInput) findInput.placeholder = t('findMode.inputPlaceholder');
            
            const findHint = document.querySelector('.find-input-hint');
            if (findHint) findHint.textContent = t('findMode.inputHint');
            
            // Update Find mode buttons
            const findBtns = {
                'findProcessBtn': 'findMode.btnProcess',
                'findChangeBtn': 'findMode.btnChange',
                'findClearBtn': 'findMode.btnClear'
            };
            
            for (const [id, key] of Object.entries(findBtns)) {
                const btn = document.getElementById(id);
                if (btn) {
                    const textSpan = btn.querySelector('span:last-child');
                    if (textSpan) {
                        const newText = t(key).replace(/^[ğŸš€ğŸ”„ğŸ—‘ï¸]\s*/, '');
                        textSpan.textContent = newText;
                    }
                }
            }
            
            // Update batch mode
            const batchBtns = {
                'processBtn': 'batchMode.btnProcess',
                'addMoreBtn': 'batchMode.btnAddMore',
                'clearBtn': 'batchMode.btnClear',
                'copyBtn': 'batchMode.btnCopy',
                'downloadBtn': 'batchMode.btnDownload'
            };
            
            for (const [id, key] of Object.entries(batchBtns)) {
                const btn = document.getElementById(id);
                if (btn) {
                    const emojiSpan = btn.querySelector('span:first-child');
                    const textSpan = btn.querySelector('span:last-child');
                    const emoji = emojiSpan ? emojiSpan.textContent.trim() : '';
                    const newText = t(key).replace(/^[ğŸš€â•ğŸ—‘ï¸ğŸ“‹â¬‡ï¸]\s*/, '');
                    
                    // æ£€æŸ¥æŒ‰é’®ç»“æ„ï¼šæ‰¹é‡æ¨¡å¼æŒ‰é’®æ˜¯ <span>emoji</span> æ–‡æœ¬èŠ‚ç‚¹
                    // Findæ¨¡å¼æŒ‰é’®æ˜¯ <span>emoji</span><span>æ–‡æœ¬</span>
                    
                    if (emojiSpan && textSpan && textSpan !== emojiSpan) {
                        // Findæ¨¡å¼ï¼šæœ‰ä¸¤ä¸ªspanï¼ˆemojiå’Œæ–‡æœ¬ï¼‰ï¼Œæ›´æ–°æ–‡æœ¬span
                        textSpan.textContent = newText;
                    } else if (emojiSpan && !textSpan) {
                        // æ‰¹é‡æ¨¡å¼ï¼šåªæœ‰ä¸€ä¸ªemoji spanï¼Œæ–‡æœ¬æ˜¯æŒ‰é’®çš„ç›´æ¥æ–‡æœ¬èŠ‚ç‚¹
                        // å…ˆæ¸…ç©ºæ‰€æœ‰éspanèŠ‚ç‚¹ï¼Œé¿å…é‡å¤
                        const nodesToRemove = [];
                        Array.from(btn.childNodes).forEach(node => {
                            // ä¿ç•™emoji spanï¼Œç§»é™¤æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ–‡æœ¬èŠ‚ç‚¹å’Œå…¶ä»–å¯èƒ½çš„spanï¼‰
                            if (node !== emojiSpan) {
                                nodesToRemove.push(node);
                            }
                        });
                        // ç§»é™¤æ‰€æœ‰éemoji spançš„èŠ‚ç‚¹
                        nodesToRemove.forEach(node => btn.removeChild(node));
                        // æ·»åŠ æ–°çš„æ–‡æœ¬èŠ‚ç‚¹ï¼ˆå¸¦ç©ºæ ¼ï¼‰
                        btn.appendChild(document.createTextNode(' ' + newText));
                    } else if (emojiSpan) {
                        // å¦‚æœåªæœ‰emoji spanä½†æ²¡æœ‰æ–‡æœ¬èŠ‚ç‚¹ï¼Œç›´æ¥è®¾ç½®innerHTML
                        btn.innerHTML = `<span>${emoji}</span> ${newText}`;
                    }
                }
            }
            
            // Update data-i18n elements
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });
            
            console.log('âœ… è¯­è¨€åˆ‡æ¢å®Œæˆ');
        }
        
        // Initialize language switcher
        function initLanguageSwitcher() {
            const switcher = document.getElementById('languageSwitcher');
            if (switcher) {
                switcher.value = currentLang;
                switcher.addEventListener('change', (e) => {
                    currentLang = e.target.value;
                    localStorage.setItem('ocr_language', currentLang);
                    updateUILanguage();
                });
            }
        }
        
        // ====================================
        // End of i18n
        // ====================================

        // Configuration
        const CONFIG = {
            apiUrl: window.location.origin || 'http://localhost:8001',
            maxConcurrent: 1 // é€ä¸€å¤„ç†
        };

        // State
        const state = {
            mode: 'document',
            images: [],
            results: [],
            isProcessing: false,
            singleImage: null  // ç”¨äº Find æ¨¡å¼çš„å•å›¾
        };

        // DOM Elements
        const elements = {
            uploadArea: document.getElementById('uploadArea'),
            fileInput: document.getElementById('fileInput'),
            imagesSection: document.getElementById('imagesSection'),
            imagesGrid: document.getElementById('imagesGrid'),
            imageCount: document.getElementById('imageCount'),
            processBtn: document.getElementById('processBtn'),
            addMoreBtn: document.getElementById('addMoreBtn'),
            clearBtn: document.getElementById('clearBtn'),
            progressSection: document.getElementById('progressSection'),
            progressBar: document.getElementById('progressBar'),
            processedCount: document.getElementById('processedCount'),
            totalCount: document.getElementById('totalCount'),
            resultSection: document.getElementById('resultSection'),
            resultText: document.getElementById('resultText'),
            copyBtn: document.getElementById('copyBtn'),
            downloadBtn: document.getElementById('downloadBtn'),
            toast: document.getElementById('toast'),
            toastIcon: document.getElementById('toastIcon'),
            toastMessage: document.getElementById('toastMessage'),
            logSection: document.getElementById('logSection'),
            logContent: document.getElementById('logContent'),
            logCount: document.getElementById('logCount')
        };

        // Initialize
        function init() {
            setupModeSelector();
            setupUpload();
            setupButtons();
            setupDragAndDrop();
            
            // æ˜¾ç¤ºæ—¥å¿—åŒºåŸŸ
            elements.logSection.classList.add('active');
            
            // åˆå§‹åŒ–æ—¥å¿— - è·å–å®é™…æœåŠ¡åœ°å€
            const getServiceAddress = () => {
                // ä¼˜å…ˆä½¿ç”¨å½“å‰é¡µé¢çš„åœ°å€
                const host = window.location.host;
                const protocol = window.location.protocol;
                if (host && host !== '') {
                    return `${protocol}//${host}`;
                }
                // å¦‚æœæ— æ³•è·å–ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„åœ°å€
                return CONFIG.apiUrl || 'http://localhost:8001';
            };
            
            addLog('System Init', 'info', 'ğŸš€ DeepSeek OCR system ready!', {
                'Version': 'v3.3.3',
                'Service': getServiceAddress(),
                'Formats': 'Images: JPG, PNG, JPEG, BMP, GIF, WEBP | PDF',
                'Modes': '7 recognition modes available'
            });
        }

        // Add Log Entry (å¢å¼ºç‰ˆ)
        function addLog(message, type = 'info', detail = '', extraData = null) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                fractionalSecondDigits: 3
            });

            // æ—¥å¿—æ¶ˆæ¯æ˜ å°„è¡¨ï¼ˆä¸­æ–‡ â†’ è‹±æ–‡ï¼‰
            const logMessages = {
                'ç³»ç»Ÿåˆå§‹åŒ–': 'System Init',
                'åˆ‡æ¢æ¨¡å¼': 'Mode Switch',
                'åˆ‡æ¢è¯†åˆ«æ¨¡å¼': 'Mode Changed',
                'æ–‡ä»¶ä¸Šä¼ å¤±è´¥': 'Upload Failed',
                'éƒ¨åˆ†æ–‡ä»¶å·²å¿½ç•¥': 'Files Ignored',
                'å¼€å§‹ä¸Šä¼ å›¾ç‰‡': 'Upload Started',
                'å›¾ç‰‡ä¸Šä¼ å®Œæˆ': 'Upload Complete',
                'å›¾ç‰‡åŠ è½½å¤±è´¥': 'Image Load Failed',
                'PDF è½¬æ¢å¼€å§‹': 'PDF Conversion Started',
                'PDF è½¬æ¢è¿›åº¦': 'PDF Converting',
                'PDF è½¬æ¢å®Œæˆ': 'PDF Conversion Complete',
                'PDF è½¬æ¢å¤±è´¥': 'PDF Conversion Failed',
                'å¼€å§‹æ‹–åŠ¨å›¾ç‰‡': 'Drag Started',
                'å›¾ç‰‡é¡ºåºå·²è°ƒæ•´': 'Order Changed',
                'å›¾ç‰‡ä¸Šä¼ æˆåŠŸ': 'Image Uploaded',
                'æ¸…ç©ºå›¾ç‰‡': 'Images Cleared',
                'æ— æ³•å¼€å§‹è¯†åˆ«': 'Cannot Start',
                'å¼€å§‹æ‰¹é‡è¯†åˆ«': 'Batch Recognition Started',
                'è¯†åˆ«å›¾ç‰‡': 'Processing Image',
                'âœ“ è¯†åˆ«æˆåŠŸ': 'âœ“ Success',
                'âœ— è¯†åˆ«å¤±è´¥': 'âœ— Failed',
                'æ‰¹é‡è¯†åˆ«å®Œæˆ': 'Batch Complete',
                'å¼€å§‹æŸ¥æ‰¾å®šä½': 'Find Started',
                'âœ“ æŸ¥æ‰¾å®šä½æˆåŠŸ': 'âœ“ Find Success',
                'æŸ¥æ‰¾å®Œæˆ': 'Find Complete',
                'âœ— æŸ¥æ‰¾å¤±è´¥': 'âœ— Find Failed',
                'å¤åˆ¶æ“ä½œå¤±è´¥': 'Copy Failed',
                'å¤åˆ¶åˆ°å‰ªè´´æ¿': 'Copied to Clipboard',
                'ä¸‹è½½æ“ä½œå¤±è´¥': 'Download Failed',
                'ä¸‹è½½è¯†åˆ«ç»“æœ': 'Downloaded',
                'æ¸…ç©ºé˜Ÿåˆ—': 'Queue Cleared',
                'æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ': 'Format Not Supported',
                'PDF è½¬æ¢æˆåŠŸ': 'PDF Converted',
                'é‡ç½® Find æ¨¡å¼': 'Find Mode Reset',
                'å¼€å§‹æŸ¥æ‰¾': 'Find Started',
                'âœ“ æŸ¥æ‰¾æˆåŠŸ': 'âœ“ Find Success'
            };

            // è½¬æ¢æ¶ˆæ¯ä¸ºè‹±æ–‡
            const englishMessage = logMessages[message] || message;

            // è·å–å›½é™…åŒ–çš„ç±»å‹æ ‡ç­¾
            const typeLabel = t(`logTypes.${type}`) || type;

            let extraHtml = '';
            if (extraData) {
                const extraItems = Object.entries(extraData).map(([key, value]) => 
                    `${key}: ${value}`
                ).join(' | ');
                extraHtml = `<div class="log-detail">${extraItems}</div>`;
            } else if (detail) {
                extraHtml = `<div class="log-detail">${detail}</div>`;
            }

            const logItem = document.createElement('div');
            logItem.className = `log-item ${type}`;
            logItem.innerHTML = `
                <div class="log-item-header">
                    <span class="log-time">${timeStr}</span>
                    <span class="log-type ${type}">${typeLabel}</span>
                </div>
                <div class="log-message">${englishMessage}</div>
                ${extraHtml}
            `;

            elements.logContent.insertBefore(logItem, elements.logContent.firstChild);

            // æ›´æ–°æ—¥å¿—è®¡æ•°
            const logCount = elements.logContent.querySelectorAll('.log-item').length;
            elements.logCount.textContent = logCount;

            // é™åˆ¶æ—¥å¿—æ•°é‡ï¼Œæœ€å¤šä¿ç•™100æ¡
            const logs = elements.logContent.querySelectorAll('.log-item');
            if (logs.length > 100) {
                logs[logs.length - 1].remove();
            }

            // è‡ªåŠ¨æ»šåŠ¨åˆ°é¡¶éƒ¨æ˜¾ç¤ºæœ€æ–°æ—¥å¿—
            elements.logContent.scrollTop = 0;
        }

        // Mode Selector
        function setupModeSelector() {
            document.querySelectorAll('.mode-option').forEach(option => {
                option.addEventListener('click', () => {
                    const oldMode = state.mode;
                    const newMode = option.dataset.mode;
                    
                    // å¦‚æœæ¨¡å¼ç›¸åŒï¼Œä¸åšä»»ä½•æ“ä½œ
                    if (oldMode === newMode) return;
                    
                    document.querySelectorAll('.mode-option').forEach(o => o.classList.remove('active'));
                    option.classList.add('active');
                    state.mode = newMode;
                    const modeName = option.querySelector('.mode-name').textContent;
                    
                    // Find æ¨¡å¼åˆ‡æ¢åˆ°ä¸“ç”¨ç•Œé¢
                    const isFindMode = (newMode === 'find');
                    const findContainer = document.getElementById('findModeContainer');
                    const batchContainer = document.getElementById('batchModeContainer');
                    
                    if (isFindMode) {
                        // åˆ‡æ¢åˆ° Find ä¸“ç”¨ç•Œé¢
                        findContainer.classList.add('active');
                        batchContainer.classList.add('hidden');
                        addLog('Mode Switch', 'info', 'Switched to Find & Locate mode (single image)', {
                            'Mode': 'ğŸ” Find Mode',
                            'Layout': 'Split view',
                            'ç‰¹æ€§': 'è¾¹ç•Œæ¡†å¯è§†åŒ–'
                        });
                    } else {
                        // åˆ‡æ¢å›æ‰¹é‡å¤„ç†ç•Œé¢
                        findContainer.classList.remove('active');
                        batchContainer.classList.remove('hidden');
                        
                        // æ˜¾ç¤º/éšè— Freeform æ‰¹é‡æ¨¡å¼çš„è¾“å…¥æ¡†
                        const freeformInputBatch = document.getElementById('freeformInputBatch');
                        if (freeformInputBatch) {
                            freeformInputBatch.style.display = (newMode === 'freeform') ? 'block' : 'none';
                        }
                        
                        addLog('Mode Switch', 'info', `Switched to ${modeName} mode (batch processing)`, {
                            'Mode': modeName,
                            'Type': 'Batch processing'
                        });
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦å·²ç»å®Œæˆè¯†åˆ«
                    const hasCompletedImages = state.images.some(img => img.status === 'completed' || img.status === 'error');
                    
                    if (hasCompletedImages) {
                        // é‡ç½®æ‰€æœ‰å›¾ç‰‡çŠ¶æ€ä¸ºå¾…å¤„ç†
                        const completedCount = state.images.filter(img => img.status === 'completed').length;
                        const errorCount = state.images.filter(img => img.status === 'error').length;
                        
                        state.images.forEach(img => {
                            img.status = 'pending';
                            img.result = null;
                        });
                        
                        // æ¸…ç©ºä¹‹å‰çš„è¯†åˆ«ç»“æœ
                        state.results = [];
                        
                        // éšè—è¿›åº¦å’Œç»“æœåŒºåŸŸ
                        elements.progressSection.classList.remove('active');
                        elements.resultSection.classList.remove('active');
                        
                        // é‡æ–°æ¸²æŸ“å›¾ç‰‡ï¼ˆæ¸…é™¤çŠ¶æ€æ ‡ç­¾ï¼‰
                        renderImages();
                        
                        // æ›´æ–°UIçŠ¶æ€ï¼ˆä½¿æŒ‰é’®å¯ç‚¹å‡»ï¼‰
                        updateUI();
                        
                        showToast(`å·²åˆ‡æ¢åˆ°: ${modeName}ï¼Œå¯ä»¥é‡æ–°è¯†åˆ«`, 'info');
                        addLog('Mode Changed', 'success', `Switched from [${getModeDisplayName(oldMode)}] to [${modeName}], state reset`, {
                            'New Mode': modeName,
                            'Use Case': getModeDescription(state.mode),
                            'å›¾ç‰‡æ•°é‡': `${state.images.length} å¼ `,
                            'å·²é‡ç½®': `${completedCount} å¼ å·²å®Œæˆï¼Œ${errorCount} å¼ å¤±è´¥`,
                            'å½“å‰çŠ¶æ€': 'å‡†å¤‡é‡æ–°è¯†åˆ«'
                        });
                    } else {
                        showToast(`å·²åˆ‡æ¢åˆ°: ${modeName}`, 'info');
                        addLog('Mode Changed', 'info', `ä» [${getModeDisplayName(oldMode)}] åˆ‡æ¢åˆ° [${modeName}]`, {
                            'Current Mode': modeName,
                            'Use Case': getModeDescription(state.mode)
                        });
                    }
                });
            });
        }

        function getModeDisplayName(mode) {
            const names = {
                'document': 'æ–‡æ¡£è½¬Markdown',
                'ocr': 'é€šç”¨OCR',
                'free': 'çº¯æ–‡æœ¬æå–',
                'figure': 'å›¾è¡¨è§£æ',
                'describe': 'å›¾åƒæè¿°',
                'find': 'æŸ¥æ‰¾å®šä½ (Find)',
                'freeform': 'è‡ªå®šä¹‰ (Freeform)'
            };
            return names[mode] || mode;
        }

        function getModeDescription(mode) {
            const descriptions = {
                'document': 'ä¿ç•™æ–‡æ¡£æ ¼å¼å’Œå¸ƒå±€',
                'ocr': 'æå–æ‰€æœ‰å¯è§æ–‡å­—',
                'free': 'çº¯æ–‡æœ¬ä¸ä¿ç•™æ ¼å¼',
                'figure': 'è¯†åˆ«å›¾è¡¨å…¬å¼ç­‰',
                'describe': 'ç”Ÿæˆè¯¦ç»†å›¾åƒæè¿°',
                'find': 'æŸ¥æ‰¾å¹¶å®šä½ç‰¹å®šå†…å®¹',
                'freeform': 'ä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯'
            };
            return descriptions[mode] || 'æœªçŸ¥';
        }

        // Upload Setup
        function setupUpload() {
            elements.uploadArea.addEventListener('click', () => {
                elements.fileInput.click();
            });

            elements.fileInput.addEventListener('change', (e) => {
                handleFiles(Array.from(e.target.files));
                e.target.value = '';
            });

            // Drag and drop
            elements.uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                elements.uploadArea.classList.add('dragover');
            });

            elements.uploadArea.addEventListener('dragleave', () => {
                elements.uploadArea.classList.remove('dragover');
            });

            elements.uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                elements.uploadArea.classList.remove('dragover');
                handleFiles(Array.from(e.dataTransfer.files));
            });
        }

        // Handle Files
        async function handleFiles(files) {
            const totalFiles = files.length;
            const imageFiles = [];
            const pdfFiles = [];
            const invalidFiles = [];
            
            // åˆ†ç±»æ–‡ä»¶
            files.forEach(file => {
                const fileType = file.type.toLowerCase();
                const fileName = file.name.toLowerCase();
                
                if (fileType.startsWith('image/') || 
                    fileName.match(/\.(jpg|jpeg|png|gif|bmp|webp)$/i)) {
                    imageFiles.push(file);
                } else if (fileType === 'application/pdf' || fileName.endsWith('.pdf')) {
                    pdfFiles.push(file);
                } else {
                    invalidFiles.push(file);
                }
            });
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆæ–‡ä»¶
            if (imageFiles.length === 0 && pdfFiles.length === 0) {
                const formats = invalidFiles.map(f => f.name.split('.').pop() || 'æœªçŸ¥').join(', ');
                showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æˆ– PDF æ–‡ä»¶', 'error');
                addLog('Upload Failed', 'error', 'All file formats not supported', {
                    'Attempted': `${totalFiles} ä¸ªæ–‡ä»¶`,
                    'Invalid Formats': formats,
                    'Supported': 'å›¾ç‰‡: JPG, PNG, JPEG, BMP, GIF, WEBP\nPDF: PDF'
                });
                return;
            }
            
            // å¤„ç†æ— æ•ˆæ–‡ä»¶æç¤º
            if (invalidFiles.length > 0) {
                const invalidNames = invalidFiles.map(f => f.name).join(', ');
                showToast(`å·²å¿½ç•¥ ${invalidFiles.length} ä¸ªä¸æ”¯æŒçš„æ–‡ä»¶`, 'warning');
                addLog('Files Ignored', 'warning', `ä¸æ”¯æŒçš„æ–‡ä»¶: ${invalidNames}`, {
                    'Ignored': `${invalidFiles.length} ä¸ª`,
                    'Supported': 'å›¾ç‰‡æˆ– PDF'
                });
            }
            
            // å¤„ç†å›¾ç‰‡æ–‡ä»¶
            if (imageFiles.length > 0) {
                const totalSize = imageFiles.reduce((sum, f) => sum + f.size, 0);
                addLog('å¼€å§‹ä¸Šä¼ å›¾ç‰‡', 'info', `æ­£åœ¨å¤„ç† ${imageFiles.length} å¼ å›¾ç‰‡...`, {
                    'æœ‰æ•ˆæ–‡ä»¶': `${imageFiles.length} å¼ `,
                    'æ€»å¤§å°': formatFileSize(totalSize)
                });

                let loadedCount = 0;
                imageFiles.forEach((file, index) => {
                    const id = Date.now() + Math.random();
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        state.images.push({
                            id,
                            file,
                            name: file.name,
                            size: formatFileSize(file.size),
                            preview: e.target.result,
                            status: 'pending',
                            result: null
                        });
                        renderImages();
                        updateUI();
                        
                        loadedCount++;
                        if (loadedCount === imageFiles.length) {
                            addLog('å›¾ç‰‡ä¸Šä¼ å®Œæˆ', 'success', `æ‰€æœ‰å›¾ç‰‡å·²åŠ è½½åˆ°é˜Ÿåˆ—`, {
                                'æˆåŠŸåŠ è½½': `${imageFiles.length} å¼ `,
                                'å½“å‰é˜Ÿåˆ—': `${state.images.length} å¼ `,
                                'è¯†åˆ«æ¨¡å¼': getModeDisplayName(state.mode)
                            });
                        }
                    };
                    
                    reader.onerror = () => {
                        addLog(`å›¾ç‰‡åŠ è½½å¤±è´¥`, 'error', `æ— æ³•è¯»å–: ${file.name}`);
                    };
                    
                    reader.readAsDataURL(file);
                });
            }
            
            // å¤„ç† PDF æ–‡ä»¶
            if (pdfFiles.length > 0) {
                for (const pdfFile of pdfFiles) {
                    await handlePDFFile(pdfFile);
                }
            }
            
            if (imageFiles.length > 0) {
                showToast(`æ·»åŠ äº† ${imageFiles.length} å¼ å›¾ç‰‡`, 'success');
            }
        }
        
        // Handle PDF File - å¤„ç† PDF æ–‡ä»¶å¹¶è½¬æ¢ä¸ºå›¾ç‰‡
        async function handlePDFFile(pdfFile) {
            try {
                showToast(`æ­£åœ¨è½¬æ¢ PDF: ${pdfFile.name}...`, 'info');
                addLog('PDF è½¬æ¢å¼€å§‹', 'info', `æ­£åœ¨å¤„ç† PDF æ–‡ä»¶: ${pdfFile.name}`, {
                    'æ–‡ä»¶å': pdfFile.name,
                    'å¤§å°': formatFileSize(pdfFile.size),
                    'çŠ¶æ€': 'è½¬æ¢ä¸­...'
                });
                
                // åˆ›å»º FormData
                const formData = new FormData();
                formData.append('file', pdfFile);
                
                // è°ƒç”¨åç«¯ PDF è½¬å›¾ç‰‡æ¥å£
                const response = await fetch(`${CONFIG.apiUrl}/pdf-to-images`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'PDF è½¬æ¢å¤±è´¥');
                }
                
                // æ˜¾ç¤ºè½¬æ¢è¿›åº¦ï¼ˆå¦‚æœåç«¯è¿”å›äº†æ€»é¡µæ•°ï¼‰
                const totalPages = data.total_pages || data.images.length;
                const pageCount = data.images.length;
                
                // æ·»åŠ å¼€å§‹è½¬æ¢çš„æ—¥å¿—
                if (totalPages > 1) {
                    addLog('PDF è½¬æ¢å¼€å§‹', 'info', `å¼€å§‹è½¬æ¢ PDFï¼Œå…± ${totalPages} é¡µ`, {
                        'æ€»é¡µæ•°': `${totalPages} é¡µ`,
                        'çŠ¶æ€': 'å¼€å§‹å¤„ç†...'
                    });
                }
                
                // ä¸ºæ¯é¡µåˆ›å»ºå›¾ç‰‡å¯¹è±¡ - ä½¿ç”¨å¼‚æ­¥å¤„ç†ç¡®ä¿å®æ—¶æ˜¾ç¤ºè¿›åº¦
                for (let index = 0; index < data.images.length; index++) {
                    const imgData = data.images[index];
                    
                    // æ·»åŠ è¿›åº¦æ—¥å¿—ï¼ˆæ¯é¡µè½¬æ¢å®Œæˆæ—¶ï¼‰- ä½¿ç”¨å¼‚æ­¥å»¶è¿Ÿç¡®ä¿å®æ—¶æ˜¾ç¤º
                    if (totalPages > 1) {
                        // ä½¿ç”¨ setTimeout è®©æµè§ˆå™¨æœ‰æ—¶é—´æ¸²æŸ“æ¯æ¡æ—¥å¿—
                        await new Promise(resolve => {
                            setTimeout(() => {
                                addLog('PDF è½¬æ¢è¿›åº¦', 'info', `æ­£åœ¨å¤„ç†ç¬¬ ${index + 1}/${totalPages} é¡µ`, {
                                    'å½“å‰é¡µ': `${index + 1}/${totalPages}`,
                                    'è¿›åº¦': `${Math.round((index + 1) / totalPages * 100)}%`
                                });
                                resolve();
                            }, index * 50); // æ¯é¡µå»¶è¿Ÿ50msï¼Œç¡®ä¿æ—¥å¿—å®æ—¶æ˜¾ç¤º
                        });
                    }
                    
                    const id = Date.now() + Math.random() + index;
                    
                    // åˆ›å»º Blob å¯¹è±¡ç”¨äºåç»­å¤„ç†
                    const base64Data = imgData.data.split(',')[1];
                    const byteCharacters = atob(base64Data);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], { type: 'image/png' });
                    const file = new File([blob], imgData.name, { type: 'image/png' });
                    
                    state.images.push({
                        id,
                        file,
                        name: imgData.name,
                        size: formatFileSize(byteArray.length),
                        preview: imgData.data, // base64 é¢„è§ˆ
                        status: 'pending',
                        result: null,
                        isFromPDF: true,
                        originalPDF: pdfFile.name,
                        pageNumber: imgData.page_number
                    });
                    
                    // å®æ—¶æ›´æ–°UIï¼ˆæ¯å¤„ç†å‡ é¡µæ›´æ–°ä¸€æ¬¡ï¼Œé¿å…è¿‡äºé¢‘ç¹ï¼‰
                    if ((index + 1) % 5 === 0 || index === data.images.length - 1) {
                        renderImages();
                        updateUI();
                    }
                }
                
                // æœ€ç»ˆæ›´æ–°UI
                renderImages();
                updateUI();
                
                // æ·»åŠ å®Œæˆæ—¥å¿—
                addLog('PDF è½¬æ¢å®Œæˆ', 'success', `PDF å·²æˆåŠŸè½¬æ¢ä¸º ${pageCount} å¼ å›¾ç‰‡`, {
                    'åŸæ–‡ä»¶': data.original_filename,
                    'æ€»é¡µæ•°': `${totalPages} é¡µ`,
                    'å·²è½¬æ¢': `${pageCount} é¡µ`,
                    'çŠ¶æ€': 'å·²æ·»åŠ åˆ°é˜Ÿåˆ—'
                });
                
                showToast(`PDF è½¬æ¢å®Œæˆï¼Œå·²æ·»åŠ  ${pageCount} å¼ å›¾ç‰‡`, 'success');
                
            } catch (error) {
                console.error('PDF è½¬æ¢é”™è¯¯:', error);
                showToast(`PDF è½¬æ¢å¤±è´¥: ${error.message}`, 'error');
                addLog('PDF è½¬æ¢å¤±è´¥', 'error', `æ— æ³•è½¬æ¢ PDF: ${pdfFile.name}`, {
                    'é”™è¯¯': error.message,
                    'æ–‡ä»¶å': pdfFile.name
                });
            }
        }

        // Render Images
        function renderImages() {
            elements.imagesGrid.innerHTML = state.images.map((img, index) => `
                <div class="image-card" draggable="true" data-id="${img.id}">
                    <div class="image-order">${index + 1}</div>
                    <button class="image-remove" onclick="removeImage('${img.id}')">Ã—</button>
                    <img src="${img.preview}" alt="${img.name}" class="image-preview">
                    <div class="image-info">
                        <div class="image-name" title="${img.name}">${img.name}</div>
                        <div class="image-size">${img.size}</div>
                    </div>
                    ${img.status !== 'pending' ? `<div class="image-status status-${img.status}">${getStatusText(img.status)}</div>` : ''}
                </div>
            `).join('');

            setupImageDragAndDrop();
        }

        // Setup Image Drag and Drop for Reordering (ä¿®å¤ç‰ˆ)
        function setupImageDragAndDrop() {
            const cards = document.querySelectorAll('.image-card');
            let draggedElement = null;
            let draggedId = null;

            cards.forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    draggedElement = card;
                    draggedId = card.dataset.id;
                    const img = state.images.find(i => i.id == draggedId);
                    card.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', card.innerHTML);
                    
                    if (img) {
                        const currentIndex = state.images.findIndex(i => i.id == draggedId);
                        addLog('å¼€å§‹æ‹–åŠ¨å›¾ç‰‡', 'info', `æ­£åœ¨è°ƒæ•´ ${img.name} çš„ä½ç½®`, {
                            'å½“å‰ä½ç½®': `ç¬¬ ${currentIndex + 1} å¼ `,
                            'æ–‡ä»¶å': img.name
                        });
                    }
                });

                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                });

                card.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    if (draggedElement && card !== draggedElement) {
                        // è·å–æ‰€æœ‰å¡ç‰‡
                        const allCards = [...elements.imagesGrid.querySelectorAll('.image-card')];
                        const draggedIndex = allCards.indexOf(draggedElement);
                        const targetIndex = allCards.indexOf(card);
                        
                        // åˆ¤æ–­åº”è¯¥æ’å…¥åˆ°ç›®æ ‡å…ƒç´ ä¹‹å‰è¿˜æ˜¯ä¹‹å
                        if (draggedIndex < targetIndex) {
                            // ä»å‰å¾€åæ‹–ï¼Œæ’å…¥åˆ°ç›®æ ‡ä¹‹å
                            card.parentNode.insertBefore(draggedElement, card.nextSibling);
                        } else {
                            // ä»åå¾€å‰æ‹–ï¼Œæ’å…¥åˆ°ç›®æ ‡ä¹‹å‰
                            card.parentNode.insertBefore(draggedElement, card);
                        }
                    }
                });

                card.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    updateImageOrder();
                });
            });

            // ä¸ºå®¹å™¨æ·»åŠ dragoveräº‹ä»¶ï¼Œé˜²æ­¢é»˜è®¤è¡Œä¸º
            elements.imagesGrid.addEventListener('dragover', (e) => {
                e.preventDefault();
            });
        }

        function updateImageOrder() {
            const cards = [...document.querySelectorAll('.image-card')];
            const newOrder = cards.map(card => card.dataset.id);
            
            // ä¿å­˜æ—§é¡ºåºç”¨äºå¯¹æ¯”
            const oldOrder = state.images.map(img => img.name);
            
            state.images.sort((a, b) => {
                return newOrder.indexOf(a.id.toString()) - newOrder.indexOf(b.id.toString());
            });
            
            const newOrderNames = state.images.map(img => img.name);
            
            renderImages();
            
            addLog('å›¾ç‰‡é¡ºåºå·²è°ƒæ•´', 'success', `æ‹–æ‹½æ’åºå®Œæˆï¼Œå·²æ›´æ–°è¯†åˆ«é¡ºåº`, {
                'æ€»æ•°é‡': `${state.images.length} å¼ `,
                'æ–°é¡ºåº': newOrderNames.slice(0, 3).join(', ') + (newOrderNames.length > 3 ? '...' : ''),
                'æ“ä½œæç¤º': 'å°†æŒ‰ç…§æ–°é¡ºåºè¿›è¡Œè¯†åˆ«'
            });
        }

        // Remove Image
        window.removeImage = function(id) {
            state.images = state.images.filter(img => img.id != id);
            renderImages();
            updateUI();
            showToast('å·²ç§»é™¤å›¾ç‰‡', 'info');
        };

        // Setup Buttons
        function setupButtons() {
            elements.processBtn.addEventListener('click', startProcessing);
            elements.addMoreBtn.addEventListener('click', () => elements.fileInput.click());
            elements.clearBtn.addEventListener('click', clearAll);
            elements.copyBtn.addEventListener('click', copyResult);
            elements.downloadBtn.addEventListener('click', downloadResult);
            
            // å•å›¾æ¨¡å¼æŒ‰é’®
            document.getElementById('processSingleBtn').addEventListener('click', processSingleImage);
            document.getElementById('changeSingleBtn').addEventListener('click', () => {
                document.getElementById('singleImagePreview').click();
            });
            document.getElementById('clearSingleBtn').addEventListener('click', clearSingleImage);
            
            // å•å›¾ä¸Šä¼ åŒºåŸŸç‚¹å‡»äº‹ä»¶
            const singlePreview = document.getElementById('singleImagePreview');
            singlePreview.addEventListener('click', (e) => {
                if (e.target.closest('.preview-placeholder') || e.target === singlePreview) {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.onchange = (e) => {
                        if (e.target.files && e.target.files[0]) {
                            handleSingleImageUpload(e.target.files[0]);
                        }
                    };
                    input.click();
                }
            });
            
            // å•å›¾æ‹–æ‹½ä¸Šä¼ 
            singlePreview.addEventListener('dragover', (e) => {
                e.preventDefault();
                singlePreview.classList.add('drag-over');
            });
            
            singlePreview.addEventListener('dragleave', () => {
                singlePreview.classList.remove('drag-over');
            });
            
            singlePreview.addEventListener('drop', (e) => {
                e.preventDefault();
                singlePreview.classList.remove('drag-over');
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleSingleImageUpload(e.dataTransfer.files[0]);
                }
            });
        }

        // Handle Single Image Uploadï¼ˆå•å›¾ä¸Šä¼ å¤„ç†ï¼‰
        function handleSingleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                showToast('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'error');
                return;
            }

            // ä¿å­˜åˆ° state
            state.singleImage = {
                file: file,
                name: file.name,
                size: formatFileSize(file.size)
            };

            // æ˜¾ç¤ºé¢„è§ˆ
            const reader = new FileReader();
            reader.onload = (e) => {
                const imgElement = document.getElementById('previewImage');
                const canvas = document.getElementById('boundingBoxCanvas');
                const placeholder = document.querySelector('.preview-placeholder');
                const container = document.getElementById('previewContainer');

                placeholder.style.display = 'none';
                container.style.display = 'block';
                
                imgElement.src = e.target.result;
                imgElement.onload = () => {
                    // æ¸…é™¤æ—§çš„è¾¹ç•Œæ¡†
                    const ctx = canvas.getContext('2d');
                    canvas.width = imgElement.offsetWidth;
                    canvas.height = imgElement.offsetHeight;
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                };

                addLog('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', 'success', `å·²åŠ è½½: ${file.name}`, {
                    'æ–‡ä»¶å': file.name,
                    'æ–‡ä»¶å¤§å°': formatFileSize(file.size),
                    'æ¨¡å¼': 'å•å›¾æŸ¥æ‰¾å®šä½'
                });
            };
            reader.readAsDataURL(file);
        }

        // Clear Single Imageï¼ˆæ¸…ç©ºå•å›¾ï¼‰
        function clearSingleImage() {
            state.singleImage = null;
            
            const placeholder = document.querySelector('.preview-placeholder');
            const container = document.getElementById('previewContainer');
            const canvas = document.getElementById('boundingBoxCanvas');
            
            placeholder.style.display = 'block';
            container.style.display = 'none';
            
            // æ¸…é™¤ canvas
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // æ¸…é™¤ç»“æœ
            elements.resultSection.classList.remove('active');
            
            showToast('å·²æ¸…ç©ºå›¾ç‰‡', 'info');
            addLog('æ¸…ç©ºå›¾ç‰‡', 'info', 'å·²æ¸…é™¤å½“å‰å›¾ç‰‡å’Œè¯†åˆ«ç»“æœ');
        }

        // Start Processing
        async function startProcessing() {
            if (state.images.length === 0) {
                showToast('è¯·å…ˆä¸Šä¼ å›¾ç‰‡', 'error');
                addLog('æ— æ³•å¼€å§‹è¯†åˆ«', 'error', 'è¯·å…ˆä¸Šä¼ è‡³å°‘ä¸€å¼ å›¾ç‰‡', {
                    'å½“å‰é˜Ÿåˆ—': '0 å¼ å›¾ç‰‡',
                    'æ“ä½œå»ºè®®': 'ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæ·»åŠ å›¾ç‰‡'
                });
                return;
            }

            const startTime = Date.now();
            state.isProcessing = true;
            state.results = [];
            elements.progressSection.classList.add('active');
            elements.resultSection.classList.remove('active');
            updateUI();

            addLog('å¼€å§‹æ‰¹é‡è¯†åˆ«', 'success', `å‡†å¤‡å¤„ç† ${state.images.length} å¼ å›¾ç‰‡`, {
                'å›¾ç‰‡æ•°é‡': `${state.images.length} å¼ `,
                'è¯†åˆ«æ¨¡å¼': getModeDisplayName(state.mode),
                'å¤„ç†æ–¹å¼': 'é€ä¸€é¡ºåºå¤„ç†',
                'é¢„è®¡æ—¶é—´': `çº¦ ${Math.ceil(state.images.length * 0.5)}-${state.images.length} åˆ†é’Ÿ`
            });

            const total = state.images.length;
            let processed = 0;
            let succeeded = 0;
            let failed = 0;

            for (let i = 0; i < state.images.length; i++) {
                const image = state.images[i];
                if (image.status === 'completed') continue;

                const imageStartTime = Date.now();
                image.status = 'processing';
                renderImages();
                
                addLog(`è¯†åˆ«å›¾ç‰‡ [${i + 1}/${total}]`, 'info', `æ­£åœ¨å¤„ç†: ${image.name}`, {
                    'æ–‡ä»¶å': image.name,
                    'æ–‡ä»¶å¤§å°': image.size,
                    'å½“å‰ä½ç½®': `ç¬¬ ${i + 1} å¼ `,
                    'é˜Ÿåˆ—è¿›åº¦': `${processed}/${total}`,
                    'è¯†åˆ«æ¨¡å¼': getModeDisplayName(state.mode)
                });

                try {
                    const result = await processImage(image);
                    const processingTime = ((Date.now() - imageStartTime) / 1000).toFixed(1);
                    
                    image.status = 'completed';
                    image.result = result;
                    state.results.push({
                        name: image.name,
                        text: result
                    });
                    succeeded++;
                    
                    const textLength = result.length;
                    const wordCount = result.split(/\s+/).length;
                    
                    addLog(`âœ“ è¯†åˆ«æˆåŠŸ [${i + 1}/${total}]`, 'success', `${image.name} å¤„ç†å®Œæˆ`, {
                        'å¤„ç†æ—¶é—´': `${processingTime} ç§’`,
                        'è¯†åˆ«å­—ç¬¦': `${textLength} ä¸ªå­—ç¬¦`,
                        'è¯æ•°ç»Ÿè®¡': `çº¦ ${wordCount} è¯`,
                        'å½“å‰è¿›åº¦': `${Math.round((processed + 1) / total * 100)}%`,
                        'å‰©ä½™æ•°é‡': `${total - processed - 1} å¼ `
                    });
                } catch (error) {
                    const processingTime = ((Date.now() - imageStartTime) / 1000).toFixed(1);
                    
                    image.status = 'error';
                    image.result = `è¯†åˆ«å¤±è´¥: ${error.message}`;
                    failed++;
                    
                    addLog(`âœ— è¯†åˆ«å¤±è´¥ [${i + 1}/${total}]`, 'error', `${image.name} å¤„ç†å‡ºé”™`, {
                        'é”™è¯¯ä¿¡æ¯': error.message,
                        'å¤„ç†æ—¶é—´': `${processingTime} ç§’`,
                        'æ–‡ä»¶å': image.name,
                        'å½“å‰è¿›åº¦': `${Math.round((processed + 1) / total * 100)}%`,
                        'å»ºè®®': 'æ£€æŸ¥å›¾ç‰‡æ ¼å¼æˆ–ç½‘ç»œè¿æ¥'
                    });
                }

                processed++;
                updateProgress(processed, total);
                renderImages();
            }

            const totalTime = ((Date.now() - startTime) / 1000).toFixed(1);
            const avgTime = (totalTime / total).toFixed(1);

            state.isProcessing = false;
            showResult();
            showToast('æ‰€æœ‰å›¾ç‰‡è¯†åˆ«å®Œæˆï¼', 'success');
            
            addLog('æ‰¹é‡è¯†åˆ«å®Œæˆ', 'success', `æ‰€æœ‰å›¾ç‰‡å¤„ç†å®Œæ¯•ï¼Œç»“æœå·²ç”Ÿæˆ`, {
                'æ€»æ•°é‡': `${total} å¼ `,
                'æˆåŠŸ': `${succeeded} å¼ `,
                'å¤±è´¥': `${failed} å¼ `,
                'æ€»è€—æ—¶': `${totalTime} ç§’`,
                'å¹³å‡è€—æ—¶': `${avgTime} ç§’/å¼ `,
                'è¯†åˆ«æ¨¡å¼': getModeDisplayName(state.mode),
                'ç»“æœé•¿åº¦': `${state.results.reduce((sum, r) => sum + r.text.length, 0)} å­—ç¬¦`
            });
        }

        // Process Single Image
        async function processImage(image) {
            const formData = new FormData();
            formData.append('file', image.file);
            formData.append('prompt_type', state.mode);
            
            // æ·»åŠ  Find æ¨¡å¼çš„æŸ¥æ‰¾è¯
            if (state.mode === 'find') {
                const findTerm = document.getElementById('findTerm').value.trim();
                formData.append('find_term', findTerm || 'Total');
            }
            
            // æ·»åŠ  Freeform æ¨¡å¼çš„è‡ªå®šä¹‰æç¤º
            if (state.mode === 'freeform') {
                const customPromptInput = document.getElementById('customPromptBatch');
                const customPrompt = customPromptInput ? customPromptInput.value.trim() : '';
                formData.append('custom_prompt', customPrompt || 'OCR this image.');
            }
            
            // å¯é€‰ï¼šæ·»åŠ  grounding å‚æ•°
            formData.append('grounding', state.mode === 'find' || state.mode === 'document' || state.mode === 'ocr');

            // æ·»åŠ  Image Result åŠŸèƒ½ - å¯ç”¨è¾¹ç•Œæ¡†å¯è§†åŒ–
            const showImageResult = state.mode === 'find' || state.mode === 'document' || state.mode === 'ocr' || state.mode === 'figure';
            formData.append('show_image_result', showImageResult);

            const response = await fetch(`${CONFIG.apiUrl}/ocr`, {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (!data.success) {
                throw new Error(data.error || 'è¯†åˆ«å¤±è´¥');
            }
            
            // å¦‚æœæœ‰ boxes ä¿¡æ¯ï¼Œä¿å­˜åˆ° image å¯¹è±¡ä¸­
            if (data.boxes && data.boxes.length > 0) {
                image.boxes = data.boxes;
                image.imageDims = data.image_dims;
            }

            // ä¿å­˜ Image Result (å¸¦çº¢è‰²æ¡†çš„å›¾åƒ)
            if (data.image_result) {
                image.imageResult = data.image_result;
            }

            return data.text;
        }

        // Draw Bounding Boxes on Canvasï¼ˆè¾¹ç•Œæ¡†ç»˜åˆ¶å‡½æ•°ï¼‰
        function drawBoundingBoxes(imgElement, canvas, boxes, imageDims) {
            if (!boxes || boxes.length === 0) {
                console.log('âŒ æ²¡æœ‰è¾¹ç•Œæ¡†éœ€è¦ç»˜åˆ¶');
                return;
            }

            console.log('ğŸ¨ å¼€å§‹ç»˜åˆ¶è¾¹ç•Œæ¡†:', boxes);

            const ctx = canvas.getContext('2d');
            
            // è®¾ç½® canvas å°ºå¯¸åŒ¹é…å›¾ç‰‡æ˜¾ç¤ºå°ºå¯¸
            canvas.width = imgElement.offsetWidth;
            canvas.height = imgElement.offsetHeight;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
            const scaleX = imgElement.offsetWidth / (imageDims?.w || imgElement.naturalWidth);
            const scaleY = imgElement.offsetHeight / (imageDims?.h || imgElement.naturalHeight);
            
            console.log('ğŸ“ ç¼©æ”¾æ¯”ä¾‹:', { scaleX, scaleY, canvasSize: { w: canvas.width, h: canvas.height } });
            
            // é¢œè‰²æ•°ç»„
            const colors = ['#00ff00', '#00ffff', '#ff00ff', '#ffff00', '#ff0066', '#00ff99'];
            
            // ç»˜åˆ¶æ¯ä¸ªè¾¹ç•Œæ¡†
            boxes.forEach((box, idx) => {
                const [x1, y1, x2, y2] = box.box;
                const color = colors[idx % colors.length];
                
                // ç¼©æ”¾åæ ‡
                const sx = x1 * scaleX;
                const sy = y1 * scaleY;
                const sw = (x2 - x1) * scaleX;
                const sh = (y2 - y1) * scaleY;
                
                console.log(`ğŸ“¦ Box ${idx} (${box.label}):`, {
                    original: [x1, y1, x2, y2],
                    scaled: [sx, sy, sw, sh]
                });
                
                // åŠé€æ˜å¡«å……
                ctx.fillStyle = color + '33';
                ctx.fillRect(sx, sy, sw, sh);
                
                // éœ“è™¹è¾¹æ¡†
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.shadowColor = color;
                ctx.shadowBlur = 10;
                ctx.strokeRect(sx, sy, sw, sh);
                ctx.shadowBlur = 0;
                
                // æ ‡ç­¾èƒŒæ™¯å’Œæ–‡å­—
                if (box.label) {
                    ctx.font = 'bold 14px Arial';
                    const metrics = ctx.measureText(box.label);
                    const padding = 8;
                    const labelHeight = 24;
                    
                    // æ ‡ç­¾èƒŒæ™¯
                    ctx.fillStyle = color;
                    ctx.fillRect(sx, sy - labelHeight, metrics.width + padding * 2, labelHeight);
                    
                    // æ ‡ç­¾æ–‡å­—
                    ctx.fillStyle = '#000';
                    ctx.fillText(box.label, sx + padding, sy - 7);
                }
            });
            
            console.log('âœ… å®Œæˆç»˜åˆ¶', boxes.length, 'ä¸ªè¾¹ç•Œæ¡†');
        }

        // Process Single Image for Find Modeï¼ˆå•å›¾å¤„ç†å‡½æ•°ï¼‰
        async function processSingleImage() {
            const findTerm = document.getElementById('findTerm').value.trim();
            if (!findTerm) {
                showToast('è¯·è¾“å…¥è¦æŸ¥æ‰¾çš„å†…å®¹', 'error');
                return;
            }

            const singleImageData = state.singleImage;
            if (!singleImageData) {
                showToast('è¯·å…ˆä¸Šä¼ å›¾ç‰‡', 'error');
                return;
            }

            addLog('å¼€å§‹æŸ¥æ‰¾å®šä½', 'info', `æ­£åœ¨å›¾ç‰‡ä¸­æŸ¥æ‰¾: ${findTerm}`, {
                'æŸ¥æ‰¾è¯': findTerm,
                'å›¾ç‰‡å': singleImageData.name,
                'æ–‡ä»¶å¤§å°': singleImageData.size
            });

            try {
                const formData = new FormData();
                formData.append('file', singleImageData.file);
                formData.append('prompt_type', 'find');
                formData.append('find_term', findTerm);
                formData.append('grounding', true);

                const response = await fetch(`${CONFIG.apiUrl}/ocr`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'è¯†åˆ«å¤±è´¥');
                }

                // æ˜¾ç¤ºç»“æœ
                elements.resultSection.classList.add('active');
                elements.resultText.textContent = data.text || 'æœªæ‰¾åˆ°åŒ¹é…å†…å®¹';

                // ç»˜åˆ¶è¾¹ç•Œæ¡†
                if (data.boxes && data.boxes.length > 0) {
                    const imgElement = document.getElementById('previewImage');
                    const canvas = document.getElementById('boundingBoxCanvas');
                    
                    // ä¿å­˜åˆ°å…¨å±€å˜é‡ä»¥ä¾¿ resize æ—¶é‡æ–°ç»˜åˆ¶
                    window.lastDrawnBoxes = data.boxes;
                    window.lastImageDims = data.image_dims;
                    
                    // ç­‰å¾…å›¾ç‰‡å®Œå…¨åŠ è½½åå†ç»˜åˆ¶
                    if (imgElement.complete) {
                        drawBoundingBoxes(imgElement, canvas, data.boxes, data.image_dims);
                    } else {
                        imgElement.onload = () => {
                            drawBoundingBoxes(imgElement, canvas, data.boxes, data.image_dims);
                        };
                    }

                    addLog('âœ“ æŸ¥æ‰¾å®šä½æˆåŠŸ', 'success', `æ‰¾åˆ° ${data.boxes.length} ä¸ªåŒ¹é…é¡¹`, {
                        'æŸ¥æ‰¾è¯': findTerm,
                        'åŒ¹é…æ•°é‡': `${data.boxes.length} ä¸ª`,
                        'åŒ¹é…é¡¹': data.boxes.map(b => b.label).join(', ')
                    });
                } else {
                    addLog('æŸ¥æ‰¾å®Œæˆ', 'info', 'æœªæ‰¾åˆ°åŒ¹é…çš„å†…å®¹', {
                        'æŸ¥æ‰¾è¯': findTerm,
                        'å»ºè®®': 'å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯'
                    });
                }

            } catch (error) {
                showToast('æŸ¥æ‰¾å¤±è´¥: ' + error.message, 'error');
                addLog('âœ— æŸ¥æ‰¾å¤±è´¥', 'error', error.message, {
                    'æŸ¥æ‰¾è¯': findTerm,
                    'å»ºè®®': 'æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æ›´æ¢å›¾ç‰‡'
                });
            }
        }

        // Update Progress
        function updateProgress(processed, total) {
            const percentage = (processed / total) * 100;
            elements.progressBar.style.width = `${percentage}%`;
            elements.processedCount.textContent = processed;
            elements.totalCount.textContent = total;
        }

        // Show Result
        function showResult() {
            elements.resultSection.classList.add('active');

            if (state.results.length === 0) {
                elements.resultText.innerHTML = `
                    <div class="result-empty">
                        <div class="result-empty-icon">ğŸ“­</div>
                        <div>æš‚æ— è¯†åˆ«ç»“æœ</div>
                    </div>
                `;
                document.getElementById('imageResultSection').style.display = 'none';
                return;
            }

            // æ˜¾ç¤ºImage Resultï¼ˆå¦‚æœæœ‰ï¼‰
            showImageResult();

            // Merge results with separators
            const mergedText = state.results.map((result, index) => {
                const separator = '='.repeat(60);
                return `${separator}\nå›¾ç‰‡ ${index + 1}: ${result.name}\n${separator}\n\n${result.text}\n\n`;
            }).join('\n');

            elements.resultText.textContent = mergedText;
        }

        // æ˜¾ç¤ºImage Resultçš„å‡½æ•°
        function showImageResult() {
            const imageResultSection = document.getElementById('imageResultSection');
            const imageResultDisplay = document.getElementById('imageResultDisplay');

            // æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæœ‰Image Resultçš„å›¾ç‰‡
            const firstImageWithResult = state.images.find(img => img.imageResult);

            if (firstImageWithResult) {
                console.log('ğŸ¨ æ˜¾ç¤ºImage Result');
                imageResultDisplay.src = firstImageWithResult.imageResult;
                imageResultSection.style.display = 'block';

                // æ·»åŠ åˆ‡æ¢æŒ‰é’®äº‹ä»¶
                const toggleBtn = document.getElementById('toggleImageResult');
                toggleBtn.onclick = () => {
                    if (imageResultSection.style.display === 'none') {
                        imageResultSection.style.display = 'block';
                        toggleBtn.innerHTML = '<span>ğŸ‘ï¸</span><span>éšè—æ˜¾ç¤º</span>';
                    } else {
                        imageResultSection.style.display = 'none';
                        toggleBtn.innerHTML = '<span>ğŸ‘ï¸</span><span>åˆ‡æ¢æ˜¾ç¤º</span>';
                    }
                };
            } else {
                imageResultSection.style.display = 'none';
            }
        }

        // Copy Result
        function copyResult() {
            const text = elements.resultText.textContent;
            if (!text || text.includes('æš‚æ— è¯†åˆ«ç»“æœ')) {
                showToast('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'error');
                addLog('å¤åˆ¶æ“ä½œå¤±è´¥', 'error', 'å½“å‰æ²¡æœ‰å¯å¤åˆ¶çš„è¯†åˆ«ç»“æœ', {
                    'åŸå› ': 'æœªè¿›è¡Œè¯†åˆ«æˆ–è¯†åˆ«æœªå®Œæˆ',
                    'å»ºè®®': 'å…ˆä¸Šä¼ å›¾ç‰‡å¹¶å®Œæˆè¯†åˆ«'
                });
                return;
            }

            navigator.clipboard.writeText(text).then(() => {
                const charCount = text.length;
                const lineCount = text.split('\n').length;
                
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                addLog('å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success', `è¯†åˆ«ç»“æœå·²æˆåŠŸå¤åˆ¶`, {
                    'å­—ç¬¦æ•°': `${charCount} ä¸ªå­—ç¬¦`,
                    'è¡Œæ•°': `${lineCount} è¡Œ`,
                    'å›¾ç‰‡æ•°': `${state.results.length} å¼ `,
                    'æ“ä½œ': 'å¯ç›´æ¥ç²˜è´´åˆ°å…¶ä»–åº”ç”¨'
                });
            }).catch((err) => {
                showToast('å¤åˆ¶å¤±è´¥', 'error');
                addLog('å¤åˆ¶æ“ä½œå¤±è´¥', 'error', 'æ— æ³•è®¿é—®å‰ªè´´æ¿', {
                    'é”™è¯¯': err.message || 'æµè§ˆå™¨å®‰å…¨é™åˆ¶',
                    'å»ºè®®': 'å°è¯•æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶æ–‡æœ¬'
                });
            });
        }

        // Download Result
        function downloadResult() {
            const text = elements.resultText.textContent;
            if (!text || text.includes('æš‚æ— è¯†åˆ«ç»“æœ')) {
                showToast('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹', 'error');
                addLog('ä¸‹è½½æ“ä½œå¤±è´¥', 'error', 'å½“å‰æ²¡æœ‰å¯ä¸‹è½½çš„è¯†åˆ«ç»“æœ', {
                    'åŸå› ': 'æœªè¿›è¡Œè¯†åˆ«æˆ–è¯†åˆ«æœªå®Œæˆ',
                    'å»ºè®®': 'å…ˆä¸Šä¼ å›¾ç‰‡å¹¶å®Œæˆè¯†åˆ«'
                });
                return;
            }

            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const filename = `OCR_ç»“æœ_${new Date().toISOString().slice(0,10)}.txt`;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);

            const fileSize = formatFileSize(blob.size);
            const charCount = text.length;
            const lineCount = text.split('\n').length;

            showToast('æ–‡ä»¶å·²ä¸‹è½½', 'success');
            addLog('ä¸‹è½½è¯†åˆ«ç»“æœ', 'success', `æ–‡ä»¶å·²ä¿å­˜åˆ°æœ¬åœ°`, {
                'æ–‡ä»¶å': filename,
                'æ–‡ä»¶å¤§å°': fileSize,
                'å­—ç¬¦æ•°': `${charCount} ä¸ªå­—ç¬¦`,
                'è¡Œæ•°': `${lineCount} è¡Œ`,
                'åŒ…å«å›¾ç‰‡': `${state.results.length} å¼ `,
                'ä¿å­˜ä½ç½®': 'æµè§ˆå™¨é»˜è®¤ä¸‹è½½æ–‡ä»¶å¤¹'
            });
        }

        // Clear All
        function clearAll() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å›¾ç‰‡å—ï¼Ÿ')) return;

            const count = state.images.length;
            const resultCount = state.results.length;
            const completedCount = state.images.filter(i => i.status === 'completed').length;
            
            state.images = [];
            state.results = [];
            renderImages();
            updateUI();
            elements.progressSection.classList.remove('active');
            elements.resultSection.classList.remove('active');
            showToast('å·²æ¸…ç©º', 'info');
            
            addLog('æ¸…ç©ºé˜Ÿåˆ—', 'info', `å·²æ¸…ç©ºæ‰€æœ‰å›¾ç‰‡å’Œç»“æœ`, {
                'æ¸…ç©ºå›¾ç‰‡': `${count} å¼ `,
                'å·²å®Œæˆ': `${completedCount} å¼ `,
                'è¯†åˆ«ç»“æœ': `${resultCount} æ¡`,
                'å½“å‰çŠ¶æ€': 'é˜Ÿåˆ—å·²æ¸…ç©ºï¼Œå¯é‡æ–°ä¸Šä¼ '
            });
        }

        // Update UI
        function updateUI() {
            const hasImages = state.images.length > 0;
            elements.imagesSection.classList.toggle('active', hasImages);
            elements.imageCount.textContent = state.images.length;
            elements.processBtn.disabled = state.isProcessing || !hasImages;
            elements.clearBtn.disabled = state.isProcessing || !hasImages;
        }

        // Setup Drag and Drop (not for reordering, but for new file drop)
        function setupDragAndDrop() {
            // Already handled in setupUpload
        }

        // Utility Functions
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function getStatusText(status) {
            const texts = {
                pending: 'ç­‰å¾…ä¸­',
                processing: 'âš™ï¸ è¯†åˆ«ä¸­...',
                completed: 'âœ… å·²å®Œæˆ',
                error: 'âŒ å¤±è´¥'
            };
            return texts[status] || status;
        }

        function showToast(message, type = 'info') {
            const icons = {
                success: 'âœ“',
                error: 'âœ•',
                info: 'â„¹'
            };

            elements.toastIcon.textContent = icons[type] || icons.info;
            elements.toastMessage.textContent = message;
            elements.toast.className = `toast ${type} active`;

            setTimeout(() => {
                elements.toast.classList.remove('active');
            }, 3000);
        }

        // Window resize event - redraw bounding boxes
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // å¦‚æœæ˜¯ Find æ¨¡å¼ä¸”æœ‰å›¾ç‰‡ï¼Œé‡æ–°ç»˜åˆ¶è¾¹ç•Œæ¡†
                if (state.mode === 'find' && state.singleImage) {
                    const imgElement = document.getElementById('previewImage');
                    const canvas = document.getElementById('boundingBoxCanvas');
                    const container = document.getElementById('previewContainer');
                    
                    if (container && container.style.display !== 'none' && imgElement.complete) {
                        // å°è¯•ä»ç»“æœä¸­è·å– boxesï¼ˆå¦‚æœå·²ç»å¤„ç†è¿‡ï¼‰
                        const resultText = elements.resultText.textContent;
                        if (resultText && window.lastDrawnBoxes) {
                            drawBoundingBoxes(imgElement, canvas, window.lastDrawnBoxes, window.lastImageDims);
                        }
                    }
                }
            }, 200);
        });

        // ====================================
        // Find Mode Functions (æŸ¥æ‰¾å®šä½æ¨¡å¼)
        // ====================================
        
        const findState = {
            image: null,
            imageData: null,
            processing: false
        };
        
        function initFindMode() {
            const uploadZone = document.getElementById('findUploadZone');
            const changeBtn = document.getElementById('findChangeBtn');
            const clearBtn = document.getElementById('findClearBtn');
            const processBtn = document.getElementById('findProcessBtn');
            const termInput = document.getElementById('findTermInput');
            
            // ä¸Šä¼ åŒºåŸŸç‚¹å‡»
            uploadZone.addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*,.pdf,application/pdf';
                input.onchange = (e) => {
                    if (e.target.files[0]) {
                        handleFindImageUpload(e.target.files[0]);
                    }
                };
                input.click();
            });
            
            // æ‹–æ‹½ä¸Šä¼ 
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('drag-over');
            });
            
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('drag-over');
            });
            
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('drag-over');
                if (e.dataTransfer.files[0]) {
                    handleFindImageUpload(e.dataTransfer.files[0]);
                }
            });
            
            // æŒ‰é’®äº‹ä»¶
            changeBtn.addEventListener('click', () => uploadZone.click());
            clearBtn.addEventListener('click', clearFindMode);
            processBtn.addEventListener('click', processFindMode);
            
            // è¾“å…¥æ¡†å˜åŒ–
            termInput.addEventListener('input', updateFindButtons);
        }
        
        async function handleFindImageUpload(file) {
            const fileType = file.type.toLowerCase();
            const fileName = file.name.toLowerCase();
            
            // æ£€æŸ¥æ˜¯å¦ä¸º PDF
            const isPDF = fileType === 'application/pdf' || fileName.endsWith('.pdf');
            
            if (!fileType.startsWith('image/') && !isPDF) {
                showToast('è¯·é€‰æ‹©å›¾ç‰‡æˆ– PDF æ–‡ä»¶', 'error');
                addLog('æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ', 'error', `ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: ${file.name}`, {
                    'æ–‡ä»¶ç±»å‹': fileType || 'æœªçŸ¥',
                    'Supported': 'å›¾ç‰‡æˆ– PDF'
                });
                return;
            }
            
            // å¦‚æœæ˜¯ PDFï¼Œå…ˆè½¬æ¢ä¸ºå›¾ç‰‡ï¼ˆåªå–ç¬¬ä¸€é¡µï¼‰
            if (isPDF) {
                try {
                    showToast('æ­£åœ¨è½¬æ¢ PDF...', 'info');
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    const response = await fetch(`${CONFIG.apiUrl}/pdf-to-images`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (!data.success || !data.images || data.images.length === 0) {
                        throw new Error(data.error || 'PDF è½¬æ¢å¤±è´¥');
                    }
                    
                    // ä½¿ç”¨ç¬¬ä¸€é¡µ
                    const firstPage = data.images[0];
                    
                    // åˆ›å»º Blob å’Œ File å¯¹è±¡
                    const base64Data = firstPage.data.split(',')[1];
                    const byteCharacters = atob(base64Data);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], { type: 'image/png' });
                    const imageFile = new File([blob], firstPage.name, { type: 'image/png' });
                    
                    // æ›´æ–°çŠ¶æ€
                    findState.image = imageFile;
                    findState.imageData = firstPage.data;
                    
                    // æ˜¾ç¤ºé¢„è§ˆ
                    const preview = document.getElementById('findUploadedPreview');
                    const img = document.getElementById('findUploadedImage');
                    const info = document.getElementById('findUploadedInfo');
                    const uploadZone = document.getElementById('findUploadZone');
                    
                    img.src = firstPage.data;
                    info.textContent = `ğŸ“„ ${file.name} (ç¬¬ 1 é¡µ) - ${formatFileSize(byteArray.length)}`;
                    
                    uploadZone.style.display = 'none';
                    preview.classList.add('active');
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    updateFindButtons();
                    
                    // æ¸…é™¤æ—§ç»“æœ
                    document.getElementById('findResultEmpty').style.display = 'block';
                    document.getElementById('findResultContainer').classList.remove('active');
                    
                    addLog('PDF è½¬æ¢æˆåŠŸ', 'success', `Find æ¨¡å¼: ${file.name} (ç¬¬ 1 é¡µ)`, {
                        'åŸæ–‡ä»¶': file.name,
                        'é¡µæ•°': `${data.page_count} é¡µ`,
                        'ä½¿ç”¨': 'ç¬¬ 1 é¡µ',
                        'æ¨¡å¼': 'æŸ¥æ‰¾å®šä½'
                    });
                    
                    showToast('PDF å·²è½¬æ¢ä¸ºå›¾ç‰‡', 'success');
                    
                } catch (error) {
                    console.error('PDF è½¬æ¢é”™è¯¯:', error);
                    showToast(`PDF è½¬æ¢å¤±è´¥: ${error.message}`, 'error');
                    addLog('PDF è½¬æ¢å¤±è´¥', 'error', `æ— æ³•è½¬æ¢ PDF: ${file.name}`, {
                        'é”™è¯¯': error.message
                    });
                }
                return;
            }
            
            // å¤„ç†æ™®é€šå›¾ç‰‡æ–‡ä»¶
            findState.image = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                findState.imageData = e.target.result;
                
                // æ˜¾ç¤ºé¢„è§ˆ
                const preview = document.getElementById('findUploadedPreview');
                const img = document.getElementById('findUploadedImage');
                const info = document.getElementById('findUploadedInfo');
                const uploadZone = document.getElementById('findUploadZone');
                
                img.src = e.target.result;
                info.textContent = `ğŸ“ ${file.name} (${formatFileSize(file.size)})`;
                
                uploadZone.style.display = 'none';
                preview.classList.add('active');
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                updateFindButtons();
                
                // æ¸…é™¤æ—§ç»“æœ
                document.getElementById('findResultEmpty').style.display = 'block';
                document.getElementById('findResultContainer').classList.remove('active');
                
                addLog('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', 'success', `Find æ¨¡å¼: ${file.name}`, {
                    'æ–‡ä»¶å': file.name,
                    'å¤§å°': formatFileSize(file.size),
                    'æ¨¡å¼': 'æŸ¥æ‰¾å®šä½'
                });
                
                showToast('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', 'success');
            };
            reader.readAsDataURL(file);
        }
        
        function clearFindMode() {
            findState.image = null;
            findState.imageData = null;
            
            // é‡ç½® UI
            document.getElementById('findUploadZone').style.display = 'block';
            document.getElementById('findUploadedPreview').classList.remove('active');
            document.getElementById('findResultEmpty').style.display = 'block';
            document.getElementById('findResultContainer').classList.remove('active');
            document.getElementById('findTermInput').value = '';
            
            updateFindButtons();
            
            addLog('é‡ç½® Find æ¨¡å¼', 'info', 'å·²æ¸…ç©ºå›¾ç‰‡å’Œç»“æœ');
            showToast('å·²æ¸…ç©º', 'info');
        }
        
        function updateFindButtons() {
            const hasImage = findState.image !== null;
            const hasTerm = document.getElementById('findTermInput').value.trim().length > 0;
            
            document.getElementById('findProcessBtn').disabled = !(hasImage && hasTerm) || findState.processing;
            document.getElementById('findChangeBtn').disabled = findState.processing;
            document.getElementById('findClearBtn').disabled = !hasImage || findState.processing;
        }
        
        async function processFindMode() {
            const findTerm = document.getElementById('findTermInput').value.trim();
            
            if (!findState.image || !findTerm) {
                showToast('è¯·ä¸Šä¼ å›¾ç‰‡å¹¶è¾“å…¥æŸ¥æ‰¾è¯', 'error');
                return;
            }
            
            findState.processing = true;
            updateFindButtons();
            
            const processBtn = document.getElementById('findProcessBtn');
            const originalText = processBtn.innerHTML;
            processBtn.innerHTML = '<span>â³</span><span>å¤„ç†ä¸­...</span>';
            
            addLog('å¼€å§‹æŸ¥æ‰¾', 'info', `æŸ¥æ‰¾è¯: ${findTerm}`, {
                'å›¾ç‰‡': findState.image.name,
                'æŸ¥æ‰¾å†…å®¹': findTerm,
                'æ¨¡å¼': 'Find + Grounding'
            });
            
            try {
                const formData = new FormData();
                formData.append('file', findState.image);
                formData.append('prompt_type', 'find');
                formData.append('find_term', findTerm);
                formData.append('grounding', true);
                formData.append('show_image_result', true);  // å¯ç”¨Image ResultåŠŸèƒ½

                const response = await fetch(`${CONFIG.apiUrl}/ocr`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'è¯†åˆ«å¤±è´¥');
                }
                
                // æ˜¾ç¤ºç»“æœ
                displayFindResult(data, findTerm);
                
            } catch (error) {
                showToast('æŸ¥æ‰¾å¤±è´¥: ' + error.message, 'error');
                addLog('âœ— æŸ¥æ‰¾å¤±è´¥', 'error', error.message);
            } finally {
                findState.processing = false;
                processBtn.innerHTML = originalText;
                updateFindButtons();
            }
        }
        
        function displayFindResult(data, findTerm) {
            // éšè—ç©ºçŠ¶æ€ï¼Œæ˜¾ç¤ºç»“æœ
            document.getElementById('findResultEmpty').style.display = 'none';
            document.getElementById('findResultContainer').classList.add('active');
            
            // æ˜¾ç¤ºç»“æœå›¾ç‰‡
            const resultImg = document.getElementById('findResultImage');
            const resultCanvas = document.getElementById('findResultCanvas');

            // ä¼˜å…ˆä½¿ç”¨åç«¯è¿”å›çš„å¸¦çº¢è‰²æ¡†çš„å›¾åƒ
            if (data.image_result) {
                console.log('ğŸ¨ ä½¿ç”¨åç«¯ç”Ÿæˆçš„Image Result');
                resultImg.src = data.image_result;

                // æ¸…ç©ºcanvasï¼Œå› ä¸ºåç«¯å·²ç»ç»˜åˆ¶äº†çº¢è‰²æ¡†
                resultCanvas.style.display = 'none';
            } else {
                // å¦åˆ™ä½¿ç”¨åŸå§‹å›¾åƒ+å‰ç«¯ç»˜åˆ¶
                console.log('ğŸ¨ ä½¿ç”¨å‰ç«¯ç»˜åˆ¶è¾¹ç•Œæ¡†');
                resultImg.src = findState.imageData;
                resultCanvas.style.display = 'block';

                // ç­‰å¾…å›¾ç‰‡åŠ è½½åç»˜åˆ¶è¾¹ç•Œæ¡†
                resultImg.onload = () => {
                    // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿å›¾ç‰‡å·²ç»æ¸²æŸ“
                    requestAnimationFrame(() => {
                        setTimeout(() => {
                            if (data.boxes && data.boxes.length > 0) {
                                drawFindBoundingBoxes(resultImg, resultCanvas, data.boxes, data.image_dims);
                            } else {
                                // æ¸…ç©º canvas
                                const ctx = resultCanvas.getContext('2d');
                                resultCanvas.width = resultImg.offsetWidth;
                                resultCanvas.height = resultImg.offsetHeight;
                                resultCanvas.style.width = resultImg.offsetWidth + 'px';
                                resultCanvas.style.height = resultImg.offsetHeight + 'px';
                                ctx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
                            }
                        }, 50);
                    });
                };

                // å¦‚æœå›¾ç‰‡å·²ç»åŠ è½½ï¼ˆæ¥è‡ªç¼“å­˜ï¼‰ï¼Œç«‹å³ç»˜åˆ¶
                if (resultImg.complete && resultImg.naturalWidth > 0) {
                    requestAnimationFrame(() => {
                        setTimeout(() => {
                            if (data.boxes && data.boxes.length > 0) {
                                drawFindBoundingBoxes(resultImg, resultCanvas, data.boxes, data.image_dims);
                            }
                        }, 50);
                    });
                }
            }
            
            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            const statsHtml = [];
            if (data.boxes && data.boxes.length > 0) {
                statsHtml.push(`<div class="find-stat-badge success">âœ“ æ‰¾åˆ° ${data.boxes.length} ä¸ªåŒ¹é…é¡¹</div>`);
                statsHtml.push(`<div class="find-stat-badge">ğŸ¯ æŸ¥æ‰¾è¯: ${findTerm}</div>`);
            } else {
                statsHtml.push(`<div class="find-stat-badge">âŒ æœªæ‰¾åˆ°åŒ¹é…é¡¹</div>`);
                statsHtml.push(`<div class="find-stat-badge">ğŸ¯ æŸ¥æ‰¾è¯: ${findTerm}</div>`);
            }
            document.getElementById('findResultStats').innerHTML = statsHtml.join('');
            
            // æ˜¾ç¤ºè¯†åˆ«æ–‡æœ¬
            document.getElementById('findResultText').textContent = data.text || 'æœªè¯†åˆ«åˆ°å†…å®¹';
            
            // æ˜¾ç¤ºåŒ¹é…é¡¹åˆ—è¡¨
            if (data.boxes && data.boxes.length > 0) {
                displayFindMatches(data.boxes);
                addLog('âœ“ æŸ¥æ‰¾æˆåŠŸ', 'success', `æ‰¾åˆ° ${data.boxes.length} ä¸ªåŒ¹é…é¡¹`, {
                    'æŸ¥æ‰¾è¯': findTerm,
                    'åŒ¹é…æ•°': data.boxes.length,
                    'åŒ¹é…é¡¹': data.boxes.map(b => b.label).join(', ')
                });
            } else {
                document.getElementById('findMatchesList').style.display = 'none';
                addLog('æŸ¥æ‰¾å®Œæˆ', 'info', 'æœªæ‰¾åˆ°åŒ¹é…å†…å®¹', {
                    'æŸ¥æ‰¾è¯': findTerm,
                    'å»ºè®®': 'å°è¯•å…¶ä»–å…³é”®è¯'
                });
            }
            
            showToast('è¯†åˆ«å®Œæˆ', 'success');
        }
        
        function drawFindBoundingBoxes(imgElement, canvas, boxes, imageDims) {
            if (!boxes || boxes.length === 0) return;
            
            console.log('ğŸ¨ ç»˜åˆ¶è¾¹ç•Œæ¡†:', boxes);
            
            const ctx = canvas.getContext('2d');
            
            // ç¡®ä¿ Canvas ç²¾ç¡®åŒ¹é…å›¾ç‰‡æ˜¾ç¤ºå°ºå¯¸
            const imgWidth = imgElement.offsetWidth;
            const imgHeight = imgElement.offsetHeight;
            
            canvas.width = imgWidth;
            canvas.height = imgHeight;
            canvas.style.width = imgWidth + 'px';
            canvas.style.height = imgHeight + 'px';
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼ˆä»åŸå§‹å›¾ç‰‡å°ºå¯¸åˆ°æ˜¾ç¤ºå°ºå¯¸ï¼‰
            const originalWidth = imageDims?.w || imgElement.naturalWidth;
            const originalHeight = imageDims?.h || imgElement.naturalHeight;
            const scaleX = imgWidth / originalWidth;
            const scaleY = imgHeight / originalHeight;
            
            console.log('ğŸ“ å›¾ç‰‡å°ºå¯¸:', {
                display: { w: imgWidth, h: imgHeight },
                original: { w: originalWidth, h: originalHeight },
                scale: { x: scaleX, y: scaleY }
            });
            
            // é¢œè‰²æ–¹æ¡ˆ
            const colors = ['#00ff00', '#00ffff', '#ff00ff', '#ffff00', '#ff0066', '#00ff99'];
            
            boxes.forEach((box, idx) => {
                const [x1, y1, x2, y2] = box.box;
                const color = colors[idx % colors.length];
                
                // ç¼©æ”¾åæ ‡
                const sx = x1 * scaleX;
                const sy = y1 * scaleY;
                const sw = (x2 - x1) * scaleX;
                const sh = (y2 - y1) * scaleY;
                
                console.log(`ğŸ“¦ Box ${idx} (${box.label}):`, [sx, sy, sw, sh]);
                
                // åŠé€æ˜å¡«å……
                ctx.fillStyle = color + '33';
                ctx.fillRect(sx, sy, sw, sh);
                
                // éœ“è™¹è¾¹æ¡†
                ctx.strokeStyle = color;
                ctx.lineWidth = 4;
                ctx.shadowColor = color;
                ctx.shadowBlur = 15;
                ctx.strokeRect(sx, sy, sw, sh);
                ctx.shadowBlur = 0;
                
                // æ ‡ç­¾
                if (box.label) {
                    ctx.font = 'bold 16px Arial';
                    const metrics = ctx.measureText(box.label);
                    const padding = 10;
                    const labelHeight = 28;
                    
                    // æ ‡ç­¾èƒŒæ™¯
                    ctx.fillStyle = color;
                    ctx.fillRect(sx, sy - labelHeight, metrics.width + padding * 2, labelHeight);
                    
                    // æ ‡ç­¾æ–‡å­—
                    ctx.fillStyle = '#000';
                    ctx.fillText(box.label, sx + padding, sy - 8);
                }
            });
            
            console.log('âœ… å®Œæˆç»˜åˆ¶', boxes.length, 'ä¸ªè¾¹ç•Œæ¡†');
        }
        
        function displayFindMatches(boxes) {
            const matchesList = document.getElementById('findMatchesList');
            const matchesContent = document.getElementById('findMatchesContent');
            
            const colors = ['#00ff00', '#00ffff', '#ff00ff', '#ffff00', '#ff0066', '#00ff99'];
            
            const matchesHtml = boxes.map((box, idx) => {
                const color = colors[idx % colors.length];
                const [x1, y1, x2, y2] = box.box;
                return `
                    <div class="find-match-item" style="border-color: ${color};">
                        <div class="find-match-color" style="background: ${color};"></div>
                        <div class="find-match-info">
                            <div class="find-match-label">${box.label}</div>
                            <div class="find-match-coords">[${x1}, ${y1}, ${x2}, ${y2}]</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            matchesContent.innerHTML = matchesHtml;
            matchesList.style.display = 'block';
        }
        
        // çª—å£ resize äº‹ä»¶ - é‡ç»˜è¾¹ç•Œæ¡†
        let findResizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(findResizeTimeout);
            findResizeTimeout = setTimeout(() => {
                if (state.mode === 'find' && findState.imageData) {
                    const resultImg = document.getElementById('findResultImage');
                    const resultCanvas = document.getElementById('findResultCanvas');
                    const resultContainer = document.getElementById('findResultContainer');
                    
                    if (resultContainer.classList.contains('active') && resultImg.complete && window.lastFindBoxes) {
                        drawFindBoundingBoxes(resultImg, resultCanvas, window.lastFindBoxes, window.lastFindImageDims);
                    }
                }
            }, 200);
        });
        
        // ä¿å­˜è¾¹ç•Œæ¡†æ•°æ®ä»¥ä¾¿ resize æ—¶é‡ç»˜
        window.lastFindBoxes = null;
        window.lastFindImageDims = null;
        
        const originalDrawFindBoundingBoxes = drawFindBoundingBoxes;
        drawFindBoundingBoxes = function(imgElement, canvas, boxes, imageDims) {
            window.lastFindBoxes = boxes;
            window.lastFindImageDims = imageDims;
            originalDrawFindBoundingBoxes(imgElement, canvas, boxes, imageDims);
        };
        
        // ====================================
        // End of Find Mode Functions
        // ====================================

        // Initialize app
        init();
        initFindMode();
        initLanguageSwitcher();
        
        // Apply initial language
        updateUILanguage();
    </script>
</body>
</html>
